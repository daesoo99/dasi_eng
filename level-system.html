<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASI English - Level System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4338ca, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .user-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* ë ˆë²¨ ì„ íƒ í™”ë©´ */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        .level-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }
        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .level-card.unlocked {
            border-color: #10b981;
        }
        .level-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
        }
        .level-card.completed {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7, #fbbf24);
        }
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .level-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #1f2937;
        }
        .level-icon {
            font-size: 2em;
        }
        .level-progress {
            background: #e5e7eb;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .level-progress-fill {
            background: linear-gradient(90deg, #10b981, #059669);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .level-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #64748b;
        }
        .level-description {
            font-size: 0.9em;
            color: #64748b;
            margin-top: 10px;
        }

        /* ìŠ¤í…Œì´ì§€ ìƒì„¸ í™”ë©´ */
        .stage-view {
            display: none;
            padding: 30px;
        }
        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        .back-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-btn:hover {
            background: #4b5563;
        }
        .stage-title {
            font-size: 2em;
            color: #1f2937;
        }
        .stage-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            justify-items: center;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
            padding: 30px 20px;
            background: #f8fafc;
            border-radius: 15px;
            max-width: 100%;
        }
        
        /* Level 2 (20ê°œ) - 10ì—´ ê·¸ë¦¬ë“œ */
        .stage-steps.level-2 {
            grid-template-columns: repeat(10, 1fr);
            max-width: 800px;
            margin: 30px auto;
        }
        
        /* Level 3 (30ê°œ) - 10ì—´ ê·¸ë¦¬ë“œ */  
        .stage-steps.level-3 {
            grid-template-columns: repeat(10, 1fr);
            max-width: 900px;
            margin: 30px auto;
        }
        .step {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .step.all-step {
            width: 60px;
            height: 60px;
            font-size: 12px;
            font-weight: bold;
        }
        .step.completed {
            background: #10b981;
            color: white;
        }
        .step.current {
            background: #3b82f6;
            color: white;
            animation: pulse 2s infinite;
        }
        .step.locked {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .stage-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .info-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
        }
        .info-card h3 {
            color: #1f2937;
            margin-bottom: 10px;
        }
        .info-card p {
            color: #64748b;
        }
        .stage-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        .start-btn {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .stats-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ê°œë°œì/ì¼ë°˜ ëª¨ë“œ í† ê¸€ */
        .mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            padding: 8px 15px;
            backdrop-filter: blur(10px);
            z-index: 10000;
        }
        .mode-label {
            color: white;
            font-size: 14px;
            font-weight: 500;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .mode-label.active {
            opacity: 1;
            font-weight: bold;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255,255,255,0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.active {
            background: #10b981;
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        .dev-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }
        .dev-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <!-- ëª¨ë“œ í† ê¸€ -->
            <div class="mode-toggle">
                <span class="mode-label active" id="normal-label">ì¼ë°˜</span>
                <div class="toggle-switch" id="toggle-switch">
                    <div class="toggle-slider"></div>
                </div>
                <span class="mode-label" id="dev-label">ê°œë°œì</span>
                <div class="dev-indicator" id="dev-indicator">DEV</div>
            </div>

            <h1>ğŸ¯ DASI English</h1>
            <p>Do you vs Are you ì™„ì „ ì •ë³µ - 10ë ˆë²¨ ì‹œìŠ¤í…œ</p>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-number" id="user-level">1</div>
                    <div class="stat-label">í˜„ì¬ ë ˆë²¨</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="total-progress">5%</div>
                    <div class="stat-label">ì „ì²´ ì§„í–‰ë¥ </div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="accuracy">85%</div>
                    <div class="stat-label">í‰ê·  ì •í™•ë„</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="total-mistakes">0</div>
                    <div class="stat-label">í‹€ë¦° ë¬¸ì œ</div>
                </div>
                <div class="stat-item review-stat" style="position: relative;">
                    <div class="stat-number" id="due-reviews">0</div>
                    <div class="stat-label">ë³µìŠµ ëŒ€ê¸°</div>
                    <div id="review-badge" class="review-badge" style="display: none; position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: bold;">
                        NEW
                    </div>
                </div>
            </div>
            
            <!-- ë³µìŠµ ì•Œë¦¼ ë²„íŠ¼ -->
            <div style="display: flex; justify-content: center; margin-top: 20px; gap: 15px;">
                <button id="review-btn" class="review-btn" style="display: none; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); transition: all 0.3s;">
                    ğŸ“– ë³µìŠµí•˜ê¸° (<span id="review-count">0</span>ê°œ)
                </button>
                <button id="stats-btn" class="stats-btn" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s;">
                    ğŸ“Š í•™ìŠµ í†µê³„
                </button>
                <button id="forgetting-curve-btn" class="forgetting-curve-btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); transition: all 0.3s;">
                    ğŸ§  ë§ê°ê³¡ì„  í˜„í™©
                </button>
            </div>
        </div>

        <!-- ë ˆë²¨ ì„ íƒ í™”ë©´ -->
        <div class="levels-view" id="levels-view">
            <div class="levels-grid" id="levels-grid">
                <!-- ë ˆë²¨ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë³µìŠµ ëª¨ë“œ í™”ë©´ -->
        <div class="review-view" id="review-view" style="display: none; padding: 30px;">
            <div class="stage-header">
                <button class="back-btn" id="back-from-review-btn">
                    â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <div class="stage-title">ğŸ“– ë³µìŠµ ëª¨ë“œ</div>
                <div></div>
            </div>
            
            <div style="background: #fef3c7; padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <h3 style="color: #92400e; margin: 0 0 15px 0;">ğŸ§  ë§ê°ê³¡ì„  ë³µìŠµ ì‹œìŠ¤í…œ</h3>
                <p style="color: #d97706; margin: 0; line-height: 1.6;">
                    í‹€ë¦° ë¬¸ì œë“¤ì„ ê³¼í•™ì  ë³µìŠµ ì£¼ê¸°ë¡œ ë°˜ë³µ í•™ìŠµí•©ë‹ˆë‹¤.<br>
                    <strong>1ì¼ â†’ 3ì¼ â†’ 7ì¼ â†’ 14ì¼</strong> ê°„ê²©ìœ¼ë¡œ ë³µìŠµí•˜ì—¬ ì¥ê¸° ê¸°ì–µì— ì €ì¥ë©ë‹ˆë‹¤.
                </p>
            </div>
            
            <div id="review-content">
                <!-- ë³µìŠµ ë¬¸ì œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- í†µê³„ ëª¨ë“œ í™”ë©´ -->
        <div class="stats-view" id="stats-view" style="display: none; padding: 30px;">
            <div class="stage-header">
                <button class="back-btn" id="back-from-stats-btn">
                    â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <div class="stage-title">ğŸ“Š í•™ìŠµ í†µê³„ ëŒ€ì‹œë³´ë“œ</div>
                <div></div>
            </div>
            
            <div id="stats-content">
                <!-- í†µê³„ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- ë§ê°ê³¡ì„  í˜„í™© í™”ë©´ -->
        <div class="forgetting-curve-view" id="forgetting-curve-view" style="display: none; padding: 30px;">
            <div class="stage-header">
                <button class="back-btn" id="back-from-curve-btn">
                    â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <div class="stage-title">ğŸ§  ë§ê°ê³¡ì„  ìƒì„¸ í˜„í™©</div>
                <div></div>
            </div>
            
            <div id="curve-content">
                <!-- ë§ê°ê³¡ì„  ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ìŠ¤í…Œì´ì§€ ìƒì„¸ í™”ë©´ -->
        <div class="stage-view" id="stage-view" style="display: none;">
            <div class="stage-header">
                <button class="back-btn" id="back-btn">
                    â† ë ˆë²¨ ì„ íƒìœ¼ë¡œ
                </button>
                <div class="stage-title" id="stage-title">Level 1 - ê¸°ì´ˆ ë™ì‚¬</div>
                <div></div>
            </div>

            <div class="stage-steps" id="stage-steps">
                <!-- ìŠ¤í…Œì´ì§€ ìŠ¤í…ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div class="stage-info">
                <div class="info-card">
                    <h3>ğŸ¯ í•™ìŠµ ë™ì‚¬</h3>
                    <p id="stage-verbs">go, have, like</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“ í•™ìŠµ íŒ¨í„´</h3>
                    <p>I go, I don't go, Do you go?<br>I'm going, I'm not going, Are you going?</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ¯ ëª©í‘œ</h3>
                    <p id="stage-target">ì •í™•ë„ 80% ì´ìƒ<br>í‰ê·  ë°˜ì‘ì†ë„ 3.0ì´ˆ ì´ë‚´</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“Š í˜„ì¬ ì„±ê³¼</h3>
                    <p id="stage-current">ì •í™•ë„: 0%<br>ìµœê³  ê¸°ë¡: 0%<br>ì‹œë„ íšŸìˆ˜: 0</p>
                </div>
            </div>

            <div class="stage-actions">
                <button class="action-btn start-btn" id="start-stage-btn">
                    ğŸš€ ìŠ¤í…Œì´ì§€ ì‹œì‘
                </button>
                <button class="action-btn stats-btn" id="stage-stats-btn">
                    ğŸ“Š ìƒì„¸ í†µê³„
                </button>
            </div>
        </div>
    </div>

    <script>
        // ë ˆë²¨ ë°ì´í„° ì •ì˜
        const levelData = [
            {
                level: 1,
                title: "êµ¬ì¡° íŒ¨í„´ ì¤‘ì‹¬ (19 ìŠ¤í…Œì´ì§€)",
                description: "ì˜ì–´ ë¬¸ì¥ì˜ ê¸°ë³¸ ë¼ˆëŒ€ë¥¼ ë‹¨ê³„ë³„ë¡œ ìŠµë“",
                verbs: ["Beë™ì‚¬", "ì¼ë°˜ë™ì‚¬", "ë¶€ì •ë¬¸", "ì˜ë¬¸ë¬¸", "ê¸°ì´ˆí™•ì¥"],
                targetAccuracy: 80,
                targetSpeed: 3.0,
                stages: 19,
                stageVerbs: {
                    1: ["Beë™ì‚¬ í˜„ì¬"], 2: ["Beë™ì‚¬ ê³¼ê±°"], 3: ["Beë™ì‚¬ ë¯¸ë˜"],
                    4: ["ì¼ë°˜ë™ì‚¬ í˜„ì¬"], 5: ["ì¼ë°˜ë™ì‚¬ ê³¼ê±°"], 6: ["ì¼ë°˜ë™ì‚¬ ë¯¸ë˜"],
                    7: ["Beë™ì‚¬ ë¶€ì •"], 8: ["ì¼ë°˜ë™ì‚¬ ë¶€ì •"],
                    9: ["Beë™ì‚¬ ì˜ë¬¸ë¬¸"], 10: ["ì¼ë°˜ë™ì‚¬ ì˜ë¬¸ë¬¸"], 11: ["Wh- ì§ˆë¬¸"],
                    12: ["There is/are"], 13: ["I like"], 14: ["I have"], 15: ["I want to"],
                    16: ["at/in/on ì „ì¹˜ì‚¬"], 17: ["a/an/the ê´€ì‚¬"], 18: ["This/That"], 19: ["Please/Can you"]
                }
            },
            {
                level: 2,
                title: "ê¸°ë³¸ ë¬¸ë²• íŒ¨í„´",
                description: "beë™ì‚¬, ì¼ë°˜ë™ì‚¬, ì¡°ë™ì‚¬ì˜ ê¸°ë³¸ íŒ¨í„´ ìŠµë“",
                verbs: ["beë™ì‚¬", "ì¼ë°˜ë™ì‚¬", "ì¡°ë™ì‚¬", "í˜„ì¬ì§„í–‰í˜•", "ê³¼ê±°í˜•", "ë¯¸ë˜í˜•"],
                targetAccuracy: 80,
                targetSpeed: 2.5,
                stages: 20,
                stageVerbs: {
                    1: ["beë™ì‚¬ í˜„ì¬í˜• (ê¸ì •ë¬¸)"],
                    2: ["beë™ì‚¬ í˜„ì¬í˜• (ë¶€ì •ë¬¸)"],
                    3: ["beë™ì‚¬ í˜„ì¬í˜• (ì˜ë¬¸ë¬¸)"],
                    4: ["ì¼ë°˜ë™ì‚¬ í˜„ì¬í˜• (ê¸ì •ë¬¸)"],
                    5: ["ì¼ë°˜ë™ì‚¬ í˜„ì¬í˜• (ë¶€ì •ë¬¸)"],
                    6: ["ì¼ë°˜ë™ì‚¬ í˜„ì¬í˜• (ì˜ë¬¸ë¬¸)"],
                    7: ["í˜„ì¬ì§„í–‰í˜• (ê¸ì •ë¬¸)"],
                    8: ["í˜„ì¬ì§„í–‰í˜• (ë¶€ì •ë¬¸)"],
                    9: ["í˜„ì¬ì§„í–‰í˜• (ì˜ë¬¸ë¬¸)"],
                    10: ["can ì¡°ë™ì‚¬ (ê¸ì •ë¬¸)"],
                    11: ["can ì¡°ë™ì‚¬ (ë¶€ì •ë¬¸)"],
                    12: ["can ì¡°ë™ì‚¬ (ì˜ë¬¸ë¬¸)"],
                    13: ["ê³¼ê±°í˜• (ê¸ì •ë¬¸)"],
                    14: ["ê³¼ê±°í˜• (ë¶€ì •ë¬¸)"],
                    15: ["ê³¼ê±°í˜• (ì˜ë¬¸ë¬¸)"],
                    16: ["will ë¯¸ë˜í˜• (ê¸ì •ë¬¸)"],
                    17: ["will ë¯¸ë˜í˜• (ë¶€ì •ë¬¸)"],
                    18: ["will ë¯¸ë˜í˜• (ì˜ë¬¸ë¬¸)"],
                    19: ["have to ì˜ë¬´í˜•"],
                    20: ["ì¢…í•© ë³µìŠµ ë° ë¹„êµê¸‰"]
                }
            },
            {
                level: 3,
                title: "ì‹œì œÂ·íƒœÂ·ë…¼ë¦¬ í™•ì¥ íŒ¨í„´",
                description: "ë³µí•© ì‹œì œ, ì¡°ë™ì‚¬, ê´€ê³„ì ˆ, ë…¼ë¦¬ ì—°ê²°ì˜ ê³ ê¸‰ ë¬¸ë²• íŒ¨í„´",
                verbs: ["ë¯¸ë˜í˜•ì‹¬í™”", "í˜„ì¬ì™„ë£Œ", "ê³¼ê±°ì™„ë£Œ", "ìˆ˜ë™íƒœ", "ì¡°ë™ì‚¬í™•ì¥", "ì¡°ê±´ë¬¸", "ê°€ì •ë²•"],
                targetAccuracy: 85,
                targetSpeed: 2.0,
                stages: 30,
                stageVerbs: {
                    1: ["ë¯¸ë˜í˜• ì‹¬í™” (will vs be going to)"],
                    2: ["í˜„ì¬ì™„ë£Œ ê²½í—˜Â·ì™„ë£Œ ìš©ë²•"],
                    3: ["í˜„ì¬ì™„ë£Œ ê²°ê³¼Â·ê³„ì† + ì‹œê°„í‘œí˜„"],
                    4: ["ê³¼ê±°ì™„ë£ŒÂ·ê³¼ê±°ì™„ë£Œì§„í–‰í˜•"],
                    5: ["ìˆ˜ë™íƒœ ê¸°ë³¸ (be + p.p.)"],
                    6: ["ìˆ˜ë™íƒœ ì‹¬í™” (ì¡°ë™ì‚¬ + ìˆ˜ë™íƒœ)"],
                    7: ["ì¡°ë™ì‚¬ í™•ì¥ 1 (would, could, might)"],
                    8: ["ì¡°ë™ì‚¬ í™•ì¥ 2 (should have, could have)"],
                    9: ["ì¡°ê±´ë¬¸ ê¸°ë³¸ (1í˜•ì‹, 2í˜•ì‹)"],
                    10: ["ê°€ì •ë²• ê³¼ê±° (If I were you)"],
                    11: ["ê°€ì •ë²• ê³¼ê±°ì™„ë£Œ (If I had known)"]
                }
            },
            {
                level: 4,
                title: "ê±°ë˜ ë™ì‚¬",
                description: "ì§„í–‰í˜•/ë¶€ì •/ì˜ë¬¸ í˜¼í•© + 1ì´ˆ ë„ì „ ì¼ë¶€",
                verbs: ["buy", "sell", "use", "try", "find"],
                targetAccuracy: 85,
                targetSpeed: 2.0,
                stages: 10,
                stageVerbs: {
                    1: ["buy"], 2: ["sell"], 3: ["use"], 4: ["try"], 5: ["find"],
                    6: ["buy", "sell"], 7: ["use", "try"], 8: ["find", "buy"], 9: ["sell", "use"], 10: ["buy", "sell", "use", "try", "find"]
                }
            },
            {
                level: 5,
                title: "ì†Œí†µ ë™ì‚¬",
                description: "3ì¸ì¹­ ë‹¨ìˆ˜/ê³¼ê±° í˜¼í•© íŒ¨í„´",
                verbs: ["give", "tell", "show", "meet", "help"],
                targetAccuracy: 88,
                targetSpeed: 1.5,
                stages: 10,
                stageVerbs: {
                    1: ["give"], 2: ["tell"], 3: ["show"], 4: ["meet"], 5: ["help"],
                    6: ["give", "tell"], 7: ["show", "meet"], 8: ["help", "give"], 9: ["tell", "show"], 10: ["give", "tell", "show", "meet", "help"]
                }
            },
            {
                level: 6,
                title: "í–‰ë™ ë™ì‚¬",
                description: "ì‹œì œ ì „í™˜ ì†ë„ ì¦ê°€",
                verbs: ["come", "leave", "start", "finish", "plan"],
                targetAccuracy: 88,
                targetSpeed: 1.5,
                stages: 10,
                stageVerbs: {
                    1: ["come"], 2: ["leave"], 3: ["start"], 4: ["finish"], 5: ["plan"],
                    6: ["come", "leave"], 7: ["start", "finish"], 8: ["plan", "come"], 9: ["leave", "start"], 10: ["come", "leave", "start", "finish", "plan"]
                }
            },
            {
                level: 7,
                title: "ì„ íƒ ë™ì‚¬",
                description: "ì´ìœ /ì˜ê²¬ ì—°ê²° íŒ¨í„´",
                verbs: ["choose", "decide", "prefer", "expect", "suppose"],
                targetAccuracy: 90,
                targetSpeed: 1.2,
                stages: 10,
                stageVerbs: {
                    1: ["choose"], 2: ["decide"], 3: ["prefer"], 4: ["expect"], 5: ["suppose"],
                    6: ["choose", "decide"], 7: ["prefer", "expect"], 8: ["suppose", "choose"], 9: ["decide", "prefer"], 10: ["choose", "decide", "prefer", "expect", "suppose"]
                }
            },
            {
                level: 8,
                title: "í—ˆìš© ë™ì‚¬",
                description: "let/make, toë¶€ì •ì‚¬ íŒ¨í„´ í™•ì¥",
                verbs: ["keep", "let", "allow", "suggest", "recommend"],
                targetAccuracy: 90,
                targetSpeed: 1.2,
                stages: 10,
                stageVerbs: {
                    1: ["keep"], 2: ["let"], 3: ["allow"], 4: ["suggest"], 5: ["recommend"],
                    6: ["keep", "let"], 7: ["allow", "suggest"], 8: ["recommend", "keep"], 9: ["let", "allow"], 10: ["keep", "let", "allow", "suggest", "recommend"]
                }
            },
            {
                level: 9,
                title: "ì „ë¬¸ ë™ì‚¬",
                description: "ì¶”ìƒ/ì—…ë¬´í˜• ë‹¨ì–´ í˜¼ì…",
                verbs: ["improve", "reduce", "compare", "analyze", "design"],
                targetAccuracy: 92,
                targetSpeed: 1.0,
                stages: 10,
                stageVerbs: {
                    1: ["improve"], 2: ["reduce"], 3: ["compare"], 4: ["analyze"], 5: ["design"],
                    6: ["improve", "reduce"], 7: ["compare", "analyze"], 8: ["design", "improve"], 9: ["reduce", "compare"], 10: ["improve", "reduce", "compare", "analyze", "design"]
                }
            },
            {
                level: 10,
                title: "ê³ ê¸‰ ë™ì‚¬",
                description: "ê³ ë‚œë„ ì¡°í•© íŒ¨í„´",
                verbs: ["coordinate", "negotiate", "prioritize", "implement", "evaluate"],
                targetAccuracy: 95,
                targetSpeed: 1.0,
                stages: 10,
                stageVerbs: {
                    1: ["coordinate"], 2: ["negotiate"], 3: ["prioritize"], 4: ["implement"], 5: ["evaluate"],
                    6: ["coordinate", "negotiate"], 7: ["prioritize", "implement"], 8: ["evaluate", "coordinate"], 9: ["negotiate", "prioritize"], 10: ["coordinate", "negotiate", "prioritize", "implement", "evaluate"]
                }
            }
        ];

        // ì‚¬ìš©ì ì§„í–‰ ìƒí™© (ì„ì‹œ ë°ì´í„°)
        let userProgress = {
            currentLevel: 1,
            levels: [
                { 
                    level: 1, 
                    completed: false, 
                    progress: 0, 
                    bestAccuracy: 0, 
                    attempts: 0,
                    stages: [
                        { stage: 1, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 2, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 3, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 4, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 5, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 6, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 7, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 8, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 9, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 10, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 11, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 12, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 13, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 14, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 15, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 16, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 17, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 18, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 19, completed: false, accuracy: 0, attempts: 0 }
                    ]
                },
                { 
                    level: 2, 
                    completed: false, 
                    progress: 15, 
                    bestAccuracy: 85, 
                    attempts: 6,
                    stages: [
                        { stage: 1, completed: true, accuracy: 82, attempts: 2 },
                        { stage: 2, completed: true, accuracy: 88, attempts: 1 },
                        { stage: 3, completed: true, accuracy: 85, attempts: 3 },
                        { stage: 4, completed: false, accuracy: 75, attempts: 2 },
                        { stage: 5, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 6, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 7, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 8, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 9, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 10, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 11, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 12, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 13, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 14, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 15, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 16, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 17, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 18, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 19, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 20, completed: false, accuracy: 0, attempts: 0 }
                    ]
                },
                { 
                    level: 3, 
                    completed: false, 
                    progress: 0, 
                    bestAccuracy: 0, 
                    attempts: 0,
                    stages: [
                        { stage: 1, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 2, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 3, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 4, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 5, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 6, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 7, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 8, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 9, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 10, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 11, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 12, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 13, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 14, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 15, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 16, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 17, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 18, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 19, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 20, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 21, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 22, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 23, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 24, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 25, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 26, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 27, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 28, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 29, completed: false, accuracy: 0, attempts: 0 },
                        { stage: 30, completed: false, accuracy: 0, attempts: 0 }
                    ]
                }
            ]
        };

        // ê°œë°œì ëª¨ë“œ ìƒíƒœ
        let isDeveloperMode = false;

        // DOM ìš”ì†Œ
        const levelsView = document.getElementById('levels-view');
        const stageView = document.getElementById('stage-view');
        const reviewView = document.getElementById('review-view');
        const statsView = document.getElementById('stats-view');
        const forgettingCurveView = document.getElementById('forgetting-curve-view');
        const levelsGrid = document.getElementById('levels-grid');
        const backBtn = document.getElementById('back-btn');
        const backFromReviewBtn = document.getElementById('back-from-review-btn');
        const backFromStatsBtn = document.getElementById('back-from-stats-btn');
        const backFromCurveBtn = document.getElementById('back-from-curve-btn');
        const reviewBtn = document.getElementById('review-btn');
        const statsBtn = document.getElementById('stats-btn');
        const forgettingCurveBtn = document.getElementById('forgetting-curve-btn');

        let currentViewLevel = null;
        let selectedStage = null;

        // localStorage ì—°ë™ (pattern-training.htmlê³¼ ë™ì¼í•œ êµ¬ì¡°)
        const STORAGE_KEYS = {
            MISTAKES: 'dasi_mistakes',
            USER_STATS: 'dasi_user_stats'
        };

        const StorageManager = {
            getMistakes() {
                try {
                    const data = localStorage.getItem(STORAGE_KEYS.MISTAKES);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('í‹€ë¦° ë¬¸ì œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    return [];
                }
            },

            getDueReviews() {
                const now = Date.now();
                const mistakes = this.getMistakes();
                return mistakes.filter(mistake => 
                    !mistake.mastered && mistake.nextReview <= now
                );
            },

            getUserStats() {
                try {
                    const data = localStorage.getItem(STORAGE_KEYS.USER_STATS);
                    return data ? JSON.parse(data) : {
                        totalSessions: 0,
                        totalQuestions: 0,
                        totalCorrect: 0,
                        totalMistakes: 0,
                        averageAccuracy: 0,
                        totalStudyTime: 0
                    };
                } catch (error) {
                    console.error('ì‚¬ìš©ì í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                    return {};
                }
            },

            // í…ŒìŠ¤íŠ¸ìš©: ì‹œê°„ ê°€ì† (ê°œë°œì ëª¨ë“œ)
            accelerateTimeForTesting() {
                const mistakes = this.getMistakes();
                const now = Date.now();
                
                mistakes.forEach(mistake => {
                    if (!mistake.mastered) {
                        // ëª¨ë“  ë³µìŠµ ì‹œê°„ì„ í˜„ì¬ ì‹œê°„ë³´ë‹¤ ê³¼ê±°ë¡œ ì„¤ì •
                        mistake.nextReview = now - Math.random() * 1000;
                    }
                });
                
                localStorage.setItem(STORAGE_KEYS.MISTAKES, JSON.stringify(mistakes));
                console.log('âš¡ ì‹œê°„ ê°€ì† ì™„ë£Œ: ëª¨ë“  ë¬¸ì œê°€ ë³µìŠµ ëŒ€ìƒì´ ë©ë‹ˆë‹¤.');
            },

            // í…ŒìŠ¤íŠ¸ìš©: ê°€ì§œ í‹€ë¦° ë¬¸ì œ ìƒì„±
            generateTestMistakes() {
                const testMistakes = [
                    {
                        id: 'test_1',
                        level: 1, stage: 1,
                        korean: 'ë‚˜ëŠ” ê°„ë‹¤', english: 'I go',
                        verb: 'go', pattern: 'present_simple_positive',
                        mistakeCount: 2, reviewStage: 0,
                        nextReview: Date.now() - 1000,
                        mastered: false
                    },
                    {
                        id: 'test_2', 
                        level: 1, stage: 2,
                        korean: 'ë‚˜ëŠ” ì•ˆ ê°„ë‹¤', english: "I don't go",
                        verb: 'go', pattern: 'present_simple_negative',
                        mistakeCount: 1, reviewStage: 1,
                        nextReview: Date.now() - 500,
                        mastered: false
                    },
                    {
                        id: 'test_3',
                        level: 2, stage: 1, 
                        korean: 'ë‚˜ëŠ” ë¨¹ëŠ” ì¤‘ì´ë‹¤', english: "I'm eating",
                        verb: 'eat', pattern: 'present_continuous_positive',
                        mistakeCount: 3, reviewStage: 0,
                        nextReview: Date.now() - 2000,
                        mastered: false
                    }
                ];

                localStorage.setItem(STORAGE_KEYS.MISTAKES, JSON.stringify(testMistakes));
                localStorage.setItem(STORAGE_KEYS.USER_STATS, JSON.stringify({
                    totalSessions: 12,
                    totalQuestions: 85,
                    totalCorrect: 70,
                    totalMistakes: 15,
                    averageAccuracy: 82.4,
                    totalStudyTime: 1800000 // 30ë¶„
                }));
                console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            },

            // ì‹œê°„ ì°¨ì´ë¥¼ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜
            getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                
                const minute = 60 * 1000;
                const hour = 60 * minute;
                const day = 24 * hour;
                const week = 7 * day;
                
                if (diff < minute) return 'ë°©ê¸ˆ ì „';
                if (diff < hour) return `${Math.floor(diff / minute)}ë¶„ ì „`;
                if (diff < day) return `${Math.floor(diff / hour)}ì‹œê°„ ì „`;
                if (diff < week) return `${Math.floor(diff / day)}ì¼ ì „`;
                return `${Math.floor(diff / week)}ì£¼ ì „`;
            },

            // ë‹¤ìŒ ë³µìŠµê¹Œì§€ ë‚¨ì€ ì‹œê°„
            getTimeUntil(timestamp) {
                const now = Date.now();
                const diff = timestamp - now;
                
                if (diff <= 0) return 'ë³µìŠµ ê°€ëŠ¥';
                
                const minute = 60 * 1000;
                const hour = 60 * minute;
                const day = 24 * hour;
                const week = 7 * day;
                
                if (diff < minute) return 'ê³§ ë³µìŠµ ê°€ëŠ¥';
                if (diff < hour) return `${Math.floor(diff / minute)}ë¶„ í›„`;
                if (diff < day) return `${Math.floor(diff / hour)}ì‹œê°„ í›„`;
                if (diff < week) return `${Math.floor(diff / day)}ì¼ í›„`;
                return `${Math.floor(diff / week)}ì£¼ í›„`;
            }
        };

        // ë ˆë²¨ ì¹´ë“œ ìƒì„±
        function createLevelCards() {
            levelsGrid.innerHTML = '';
            
            levelData.forEach(level => {
                const userLevelData = userProgress.levels.find(l => l.level === level.level) || 
                                    { level: level.level, completed: false, progress: 0, bestAccuracy: 0, attempts: 0 };
                
                // ê°œë°œì ëª¨ë“œì¼ ë•ŒëŠ” ëª¨ë“  ë ˆë²¨ í•´ì œ, ì¼ë°˜ ëª¨ë“œì—ì„œëŠ” ì´ì „ ë ˆë²¨ ì™„ë£Œ ì‹œì—ë§Œ í•´ì œ
                const isUnlocked = isDeveloperMode || level.level === 1 || 
                                 (userProgress.levels.find(l => l.level === level.level - 1 && l.completed));
                const isCompleted = userLevelData.completed;
                
                const card = document.createElement('div');
                card.className = `level-card ${isCompleted ? 'completed' : (isUnlocked ? 'unlocked' : 'locked')}`;
                
                let icon = 'ğŸ”’';
                if (isCompleted) icon = 'ğŸ†';
                else if (isUnlocked) icon = 'â­';
                
                card.innerHTML = `
                    <div class="level-header">
                        <div class="level-title">Level ${level.level}</div>
                        <div class="level-icon">${icon}</div>
                    </div>
                    <div class="level-progress">
                        <div class="level-progress-fill" style="width: ${userLevelData.progress}%"></div>
                    </div>
                    <div class="level-stats">
                        <span>ì§„í–‰ë¥ : ${userLevelData.progress}%</span>
                        <span>ìµœê³ : ${userLevelData.bestAccuracy}%</span>
                    </div>
                    <h3 style="margin: 10px 0 5px 0; color: #1f2937;">${level.title}</h3>
                    <div class="level-description">${level.description}</div>
                    <div class="level-description" style="margin-top: 10px;">
                        <strong>ë™ì‚¬:</strong> ${level.verbs.join(', ')}
                    </div>
                    <div class="level-description">
                        <strong>ëª©í‘œ:</strong> ì •í™•ë„ ${level.targetAccuracy}%
                    </div>
                `;
                
                if (isUnlocked) {
                    card.addEventListener('click', () => showStageView(level.level));
                }
                
                levelsGrid.appendChild(card);
            });
        }

        // ìŠ¤í…Œì´ì§€ ë·° í‘œì‹œ
        function showStageView(levelNum) {
            currentViewLevel = levelNum;
            const level = levelData.find(l => l.level === levelNum);
            
            levelsView.style.display = 'none';
            stageView.style.display = 'block';
            
            document.getElementById('stage-title').textContent = `Level ${level.level} - ${level.title}`;
            document.getElementById('stage-verbs').textContent = level.verbs.join(', ');
            document.getElementById('stage-target').innerHTML = 
                `ì •í™•ë„ ${level.targetAccuracy}% ì´ìƒ`;
            
            createStageSteps(level);
        }

        // ìŠ¤í…Œì´ì§€ ìŠ¤í… ìƒì„±
        function createStageSteps(level) {
            const stageSteps = document.getElementById('stage-steps');
            stageSteps.innerHTML = '';
            
            // ë ˆë²¨ì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ì¶”ê°€
            stageSteps.className = `stage-steps level-${level.level}`;
            
            const userLevelData = userProgress.levels.find(l => l.level === level.level);
            const userStages = userLevelData?.stages || [];
            
            for (let i = 1; i <= level.stages; i++) {
                const step = document.createElement('div');
                step.className = 'step';
                step.textContent = i;
                
                const stageData = userStages.find(s => s.stage === i);
                
                if (stageData?.completed) {
                    step.classList.add('completed');
                    step.title = `ì™„ë£Œë¨ - ì •í™•ë„: ${stageData.accuracy}%, ì‹œë„: ${stageData.attempts}ë²ˆ`;
                } else if (isDeveloperMode || i === 1 || (userStages.find(s => s.stage === i - 1)?.completed)) {
                    // ê°œë°œì ëª¨ë“œì´ê±°ë‚˜, ì²« ë²ˆì§¸ ìŠ¤í…Œì´ì§€ì´ê±°ë‚˜, ì´ì „ ìŠ¤í…Œì´ì§€ê°€ ì™„ë£Œëœ ê²½ìš°
                    if (stageData && stageData.attempts > 0) {
                        step.classList.add('current');
                        step.title = `ì§„í–‰ì¤‘ - ìµœê³ : ${stageData.accuracy}%, ì‹œë„: ${stageData.attempts}ë²ˆ`;
                    } else {
                        step.classList.add('current');
                        step.title = 'ì‹œì‘ ê°€ëŠ¥';
                    }
                } else {
                    step.classList.add('locked');
                    step.title = 'ì ê¸ˆë¨ - ì´ì „ ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí•˜ì„¸ìš”';
                }
                
                step.addEventListener('click', () => {
                    if (!step.classList.contains('locked')) {
                        selectStage(level.level, i);
                    }
                });
                
                stageSteps.appendChild(step);
            }
            
            // ALL ë²„íŠ¼ ì¶”ê°€
            
            const allStep = document.createElement('div');
            allStep.className = 'step all-step';
            allStep.textContent = 'ALL';
            
            // ì ê¸ˆ ìƒíƒœ í™•ì¸
            const isAllUnlocked = isDeveloperMode || allStagesCompleted;
            
            if (isAllUnlocked) {
                allStep.title = 'ë ˆë²¨ ì „ì²´ ë™ì‚¬ í†µí•© í›ˆë ¨';
                allStep.style.cssText = `
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                    font-weight: bold;
                    width: 50px;
                    font-size: 12px;
                    cursor: pointer;
                `;
                
                allStep.addEventListener('click', () => {
                    selectAllStage(level.level);
                });
            } else {
                allStep.title = 'ì ê¸ˆë¨ - ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí•˜ì„¸ìš”';
                allStep.classList.add('locked');
                allStep.style.cssText = `
                    background: #e5e7eb;
                    color: #9ca3af;
                    font-weight: bold;
                    width: 50px;
                    font-size: 12px;
                    cursor: not-allowed;
                `;
            }
            
            stageSteps.appendChild(allStep);
        }

        // ìŠ¤í…Œì´ì§€ ì„ íƒ
        function selectStage(levelNum, stageNum) {
            console.log(`Selected Level ${levelNum}, Stage ${stageNum}`);
            
            selectedStage = stageNum; // ì„ íƒëœ ìŠ¤í…Œì´ì§€ ì €ì¥
            
            const level = levelData.find(l => l.level === levelNum);
            const userLevelData = userProgress.levels.find(l => l.level === levelNum);
            const stageData = userLevelData?.stages?.find(s => s.stage === stageNum);
            
            // ìŠ¤í…Œì´ì§€ë³„ ë™ì‚¬ í‘œì‹œ
            const stageVerbs = level?.stageVerbs?.[stageNum] || level?.verbs || [];
            document.getElementById('stage-verbs').textContent = stageVerbs.join(', ');
            
            if (stageData) {
                const status = stageData.completed ? 'ì™„ë£Œ' : (stageData.attempts > 0 ? 'ë„ì „ì¤‘' : 'ë¯¸ì‹œì‘');
                document.getElementById('stage-current').innerHTML = 
                    `ìƒíƒœ: ${status}<br>ì •í™•ë„: ${stageData.accuracy}%<br>ì‹œë„ íšŸìˆ˜: ${stageData.attempts}ë²ˆ`;
            } else {
                document.getElementById('stage-current').innerHTML = 
                    `ìƒíƒœ: ë¯¸ì‹œì‘<br>ì •í™•ë„: 0%<br>ì‹œë„ íšŸìˆ˜: 0ë²ˆ`;
            }
            
            // ì„ íƒëœ ìŠ¤í…Œì´ì§€ í•˜ì´ë¼ì´íŠ¸
            const allSteps = document.querySelectorAll('.step');
            allSteps.forEach((step, index) => {
                if (index + 1 === stageNum && !step.classList.contains('locked')) {
                    step.style.border = '3px solid #f59e0b';
                } else {
                    step.style.border = 'none';
                }
            });
        }

        // ALL ìŠ¤í…Œì´ì§€ ì„ íƒ (ë ˆë²¨ ì „ì²´ í†µí•©)
        function selectAllStage(levelNum) {
            const level = levelData.find(l => l.level === levelNum);
            const userLevelData = userProgress.levels.find(l => l.level === levelNum);
            const userStages = userLevelData?.stages || [];
            
            // ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ í™•ì¸
            const allStagesCompleted = userStages.length === level.stages && 
                                     userStages.every(stage => stage.completed);
            
            if (!isDeveloperMode && !allStagesCompleted) {
                alert('ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí•´ì•¼ ALL ëª¨ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                return;
            }
            
            console.log(`Selected Level ${levelNum}, ALL Stages`);
            
            selectedStage = 'ALL'; // ALLë¡œ ì„¤ì •
            
            // ë ˆë²¨ì˜ ëª¨ë“  ë™ì‚¬ í‘œì‹œ
            document.getElementById('stage-verbs').textContent = level.verbs.join(', ');
            
            // ALL ìŠ¤í…Œì´ì§€ ì •ë³´ í‘œì‹œ
            document.getElementById('stage-current').innerHTML = 
                `ìƒíƒœ: ë ˆë²¨ í†µí•© í›ˆë ¨<br>ëª¨ë“  ë™ì‚¬ í˜¼í•© í•™ìŠµ<br>ìµœê³  ë‚œì´ë„`;
            
            // ëª¨ë“  ìŠ¤í… ì„ íƒ í•´ì œí•˜ê³  ALLë§Œ í•˜ì´ë¼ì´íŠ¸
            const allSteps = document.querySelectorAll('.step');
            allSteps.forEach(step => {
                if (step.classList.contains('all-step') && !step.classList.contains('locked')) {
                    step.style.border = '3px solid #f59e0b';
                    step.style.transform = 'scale(1.1)';
                } else {
                    step.style.border = 'none';
                    step.style.transform = 'scale(1)';
                }
            });
        }

        // ë’¤ë¡œ ê°€ê¸°
        backBtn.addEventListener('click', () => {
            levelsView.style.display = 'block';
            stageView.style.display = 'none';
            currentViewLevel = null;
        });

        // ìŠ¤í…Œì´ì§€ ì‹œì‘ ë²„íŠ¼
        document.getElementById('start-stage-btn').addEventListener('click', () => {
            if (currentViewLevel && selectedStage) {
                const level = levelData.find(l => l.level === currentViewLevel);
                
                let stageVerbs;
                if (selectedStage === 'ALL') {
                    // ALL ì„ íƒ ì‹œ ë ˆë²¨ì˜ ëª¨ë“  ë™ì‚¬ ì‚¬ìš©
                    stageVerbs = level.verbs;
                } else {
                    // ì¼ë°˜ ìŠ¤í…Œì´ì§€ëŠ” ê¸°ì¡´ ë¡œì§
                    stageVerbs = level?.stageVerbs?.[selectedStage] || level?.verbs || [];
                }
                
                // ë ˆë²¨ë³„ ì ì ˆí•œ ì—°ìŠµ í˜ì´ì§€ë¡œ ì´ë™
                if (currentViewLevel === 3) {
                    // Level 3ëŠ” Speaking ë°©ì‹ ì‚¬ìš©
                    window.open(`level3-practice-speaking.html?stage=${selectedStage}`, '_blank');
                } else {
                    // Level 1-2ëŠ” ê¸°ì¡´ pattern-training.html ì‚¬ìš©
                    const params = new URLSearchParams({
                        level: currentViewLevel,
                        stage: selectedStage,
                        verbs: stageVerbs.join(','),
                        targetAccuracy: level.targetAccuracy,
                        developerMode: isDeveloperMode ? 'true' : 'false'
                    });
                    
                    window.open(`pattern-training.html?${params.toString()}`, '_blank');
                }
            } else {
                alert('ë¨¼ì € ìŠ¤í…Œì´ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
            }
        });

        // í†µê³„ ë²„íŠ¼
        document.getElementById('stage-stats-btn').addEventListener('click', () => {
            alert('ìƒì„¸ í†µê³„ í™”ë©´ì„ í‘œì‹œí•©ë‹ˆë‹¤.');
        });

        // ëª¨ë“œ í† ê¸€ ê¸°ëŠ¥
        function toggleDeveloperMode() {
            isDeveloperMode = !isDeveloperMode;
            
            const toggleSwitch = document.getElementById('toggle-switch');
            const normalLabel = document.getElementById('normal-label');
            const devLabel = document.getElementById('dev-label');
            const devIndicator = document.getElementById('dev-indicator');
            
            if (isDeveloperMode) {
                // ê°œë°œì ëª¨ë“œ í™œì„±í™”
                toggleSwitch.classList.add('active');
                normalLabel.classList.remove('active');
                devLabel.classList.add('active');
                devIndicator.classList.add('show');
                console.log('ğŸ”§ ê°œë°œì ëª¨ë“œ í™œì„±í™” - ëª¨ë“  ë ˆë²¨ í•´ì œë¨');
            } else {
                // ì¼ë°˜ ëª¨ë“œ í™œì„±í™”
                toggleSwitch.classList.remove('active');
                normalLabel.classList.add('active');
                devLabel.classList.remove('active');
                devIndicator.classList.remove('show');
                console.log('ğŸ‘¤ ì¼ë°˜ ëª¨ë“œ í™œì„±í™” - ì§„í–‰ë¥ ì— ë”°ë¥¸ ì ê¸ˆ');
            }
            
            // ë ˆë²¨ ì¹´ë“œ ë‹¤ì‹œ ìƒì„±
            createLevelCards();
        }

        // í† ê¸€ ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸
        document.getElementById('toggle-switch').addEventListener('click', toggleDeveloperMode);

        function updateUserStats() {
            // ê¸°ì¡´ ì§„í–‰ë¥  í†µê³„
            const completedLevels = userProgress.levels.filter(l => l.completed).length;
            const totalProgress = userProgress.levels.reduce((sum, level) => sum + level.progress, 0) / 10;
            const avgAccuracy = userProgress.levels.length > 0 ? 
                userProgress.levels.reduce((sum, level) => sum + level.bestAccuracy, 0) / userProgress.levels.length : 0;
            
            // localStorage ê¸°ë°˜ ì‹¤ì œ ë°ì´í„°
            const realStats = StorageManager.getUserStats();
            const mistakes = StorageManager.getMistakes();
            const dueReviews = StorageManager.getDueReviews();
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('user-level').textContent = Math.max(completedLevels, 1);
            document.getElementById('total-progress').textContent = Math.round(totalProgress) + '%';
            
            // ì‹¤ì œ ì •í™•ë„ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê°€ìƒ ë°ì´í„° ì‚¬ìš©
            const displayAccuracy = realStats.averageAccuracy || Math.round(avgAccuracy);
            document.getElementById('accuracy').textContent = displayAccuracy + '%';
            
            // localStorage ê¸°ë°˜ ì¶”ê°€ í†µê³„
            document.getElementById('total-mistakes').textContent = mistakes.length;
            document.getElementById('due-reviews').textContent = dueReviews.length;
            document.getElementById('review-count').textContent = dueReviews.length;
            
            // ë³µìŠµ ëŒ€ìƒì´ ìˆìœ¼ë©´ ë²„íŠ¼ê³¼ ë°°ì§€ í‘œì‹œ
            const reviewBadge = document.getElementById('review-badge');
            if (dueReviews.length > 0) {
                reviewBtn.style.display = 'inline-block';
                reviewBadge.style.display = 'block';
                reviewBadge.textContent = dueReviews.length > 9 ? '9+' : dueReviews.length;
                
                // ë³µìŠµ ëŒ€ìƒì´ 5ê°œ ì´ìƒì´ë©´ ê°•ì¡°
                if (dueReviews.length >= 5) {
                    reviewBtn.style.animation = 'pulse 2s infinite';
                }
            } else {
                reviewBtn.style.display = 'none';
                reviewBadge.style.display = 'none';
            }
        }

        // ë³µìŠµ ëª¨ë“œ í‘œì‹œ
        function showReviewMode() {
            levelsView.style.display = 'none';
            stageView.style.display = 'none';
            statsView.style.display = 'none';
            reviewView.style.display = 'block';
            
            const dueReviews = StorageManager.getDueReviews();
            const reviewContent = document.getElementById('review-content');
            
            if (dueReviews.length === 0) {
                reviewContent.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: #6b7280;">
                        <div style="font-size: 4em; margin-bottom: 20px;">ğŸ‰</div>
                        <h3>ë³µìŠµí•  ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</h3>
                        <p>ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í–ˆê±°ë‚˜, ì•„ì§ ë³µìŠµ ì‹œê°„ì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                        <button onclick="StorageManager.generateTestMistakes(); location.reload();" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }
            
            reviewContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                    ${dueReviews.map(mistake => `
                        <div class="review-card" style="background: white; border: 2px solid #f59e0b; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                                <span style="background: #fbbf24; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                    Level ${mistake.level}-${mistake.stage}
                                </span>
                                <span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                    ${mistake.mistakeCount}ë²ˆ í‹€ë¦¼
                                </span>
                            </div>
                            <div style="font-size: 18px; font-weight: bold; color: #1f2937; margin-bottom: 10px;">
                                ${mistake.korean}
                            </div>
                            <div style="font-size: 16px; color: #059669; margin-bottom: 15px;">
                                ${mistake.english}
                            </div>
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 15px;">
                                íŒ¨í„´: ${mistake.pattern} | ë™ì‚¬: ${mistake.verb}
                            </div>
                            <button onclick="startReviewQuestion('${mistake.id}')" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                                ğŸ¯ ì§€ê¸ˆ ë³µìŠµí•˜ê¸°
                            </button>
                        </div>
                    `).join('')}
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="startAllReview()" style="padding: 15px 30px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                        ğŸ“š ëª¨ë“  ë³µìŠµ ë¬¸ì œ í•œë²ˆì— ì‹œì‘í•˜ê¸° (${dueReviews.length}ê°œ)
                    </button>
                </div>
            `;
        }

        // ë§ê°ê³¡ì„  í˜„í™© ëª¨ë“œ í‘œì‹œ
        function showForgettingCurveMode() {
            levelsView.style.display = 'none';
            stageView.style.display = 'none';
            reviewView.style.display = 'none';
            statsView.style.display = 'none';
            forgettingCurveView.style.display = 'block';
            
            const mistakes = StorageManager.getMistakes();
            const curveContent = document.getElementById('curve-content');
            
            if (mistakes.length === 0) {
                curveContent.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: #6b7280;">
                        <div style="font-size: 4em; margin-bottom: 20px;">ğŸ¤”</div>
                        <h3>ë§ê°ê³¡ì„  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í•™ìŠµì„ ì§„í–‰í•˜ë©´ì„œ í‹€ë¦° ë¬¸ì œë“¤ì´ ìˆ˜ì§‘ë˜ë©´ ë§ê°ê³¡ì„  í˜„í™©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <button onclick="StorageManager.generateTestMistakes(); location.reload();" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }
            
            // ë³µìŠµ ë‹¨ê³„ë³„ë¡œ ë¬¸ì œ ë¶„ë¥˜
            const reviewStages = [
                { stage: 0, name: '1ì¼ ëŒ€ê¸°', interval: '1ì¼', color: '#ef4444' },
                { stage: 1, name: '3ì¼ ëŒ€ê¸°', interval: '3ì¼', color: '#f59e0b' },
                { stage: 2, name: '7ì¼ ëŒ€ê¸°', interval: '7ì¼', color: '#3b82f6' },
                { stage: 3, name: '14ì¼ ëŒ€ê¸°', interval: '14ì¼', color: '#8b5cf6' },
                { stage: 4, name: 'ë§ˆìŠ¤í„° ì™„ë£Œ', interval: 'ì™„ë£Œ', color: '#10b981' }
            ];
            
            curveContent.innerHTML = `
                <!-- ë§ê°ê³¡ì„  ê°œìš” -->
                <div style="background: #f0f9ff; padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 4px solid #3b82f6;">
                    <h3 style="color: #1e40af; margin-bottom: 15px;">ğŸ§  ë§ê°ê³¡ì„  ë³µìŠµ ì‹œìŠ¤í…œ</h3>
                    <p style="color: #3730a3; margin: 0; line-height: 1.6;">
                        ì—ë¹™í•˜ìš°ìŠ¤ ë§ê°ê³¡ì„ ì— ë”°ë¼ <strong>1ì¼ â†’ 3ì¼ â†’ 7ì¼ â†’ 14ì¼</strong> ê°„ê²©ìœ¼ë¡œ ë³µìŠµí•˜ì—¬<br>
                        ì¥ê¸°ê¸°ì–µì— ì €ì¥ì‹œí‚µë‹ˆë‹¤. ì´ <strong>${mistakes.length}ê°œ</strong> ë¬¸ì œê°€ ì‹œìŠ¤í…œì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                
                <!-- ë‹¨ê³„ë³„ í˜„í™© -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    ${reviewStages.map(stageInfo => {
                        const stageProblems = mistakes.filter(m => 
                            stageInfo.stage === 4 ? m.mastered : (!m.mastered && m.reviewStage === stageInfo.stage)
                        );
                        return `
                            <div style="background: white; padding: 20px; border-radius: 15px; border-left: 4px solid ${stageInfo.color}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #1f2937; margin: 0;">${stageInfo.name}</h4>
                                    <span style="background: ${stageInfo.color}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                        ${stageProblems.length}ê°œ
                                    </span>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">ë³µìŠµ ê°„ê²©: ${stageInfo.interval}</div>
                                <div style="max-height: 120px; overflow-y: auto;">
                                    ${stageProblems.length > 0 ? 
                                        stageProblems.slice(0, 3).map(mistake => `
                                            <div style="padding: 6px 0; border-bottom: 1px solid #f3f4f6; font-size: 13px;">
                                                <div style="font-weight: 500; color: #1f2937;">${mistake.korean}</div>
                                                <div style="color: #6b7280;">${mistake.english}</div>
                                            </div>
                                        `).join('') + (stageProblems.length > 3 ? `<div style="text-align: center; padding: 8px; color: #6b7280; font-size: 12px;">+${stageProblems.length - 3}ê°œ ë”</div>` : '')
                                        : '<div style="text-align: center; color: #9ca3af; font-size: 12px; padding: 20px;">ë¬¸ì œ ì—†ìŒ</div>'
                                    }
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <!-- ìƒì„¸ ë¬¸ì œ ëª©ë¡ -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h3 style="color: #1f2937; margin-bottom: 20px;">ğŸ“‹ ì „ì²´ ë¬¸ì œ ìƒì„¸ í˜„í™©</h3>
                    <div style="display: grid; gap: 15px;">
                        ${mistakes.map((mistake, index) => {
                            const stageInfo = reviewStages[mistake.mastered ? 4 : mistake.reviewStage];
                            const timeAgo = StorageManager.getTimeAgo(mistake.firstMistake);
                            const nextReview = mistake.mastered ? 'ì™„ë£Œ' : StorageManager.getTimeUntil(mistake.nextReview);
                            const isDue = !mistake.mastered && mistake.nextReview <= Date.now();
                            
                            return `
                                <div style="background: ${isDue ? '#fef3c7' : '#f9fafb'}; padding: 15px; border-radius: 10px; border-left: 4px solid ${stageInfo.color};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div style="font-size: 16px; font-weight: bold; color: #1f2937;">
                                            ${mistake.korean} â†’ ${mistake.english}
                                        </div>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            ${isDue ? '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">ë³µìŠµ ê°€ëŠ¥</span>' : ''}
                                            <span style="background: ${stageInfo.color}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">
                                                ${stageInfo.name}
                                            </span>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; font-size: 12px; color: #6b7280;">
                                        <div>ğŸ“… ì²« ì‹¤ìˆ˜: ${timeAgo}</div>
                                        <div>ğŸ’” í‹€ë¦° íšŸìˆ˜: ${mistake.mistakeCount}ë²ˆ</div>
                                        <div>ğŸ”„ ë³µìŠµ ë‹¨ê³„: ${mistake.reviewStage + 1}/4</div>
                                        <div>â° ë‹¤ìŒ ë³µìŠµ: ${nextReview}</div>
                                        <div>ğŸ“ ë ˆë²¨: ${mistake.level}-${mistake.stage}</div>
                                        <div>ğŸ·ï¸ íŒ¨í„´: ${mistake.pattern}</div>
                                    </div>
                                    ${isDue ? `
                                        <div style="margin-top: 10px; text-align: right;">
                                            <button onclick="startReviewQuestion('${mistake.id}')" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                                ğŸ¯ ì§€ê¸ˆ ë³µìŠµí•˜ê¸°
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <!-- ê°œë°œì ë„êµ¬ -->
                <div style="background: #f1f5f9; padding: 20px; border-radius: 15px; border: 2px dashed #cbd5e1; margin-top: 30px;">
                    <h3 style="color: #64748b; margin-bottom: 15px;">ğŸ› ï¸ ë§ê°ê³¡ì„  í…ŒìŠ¤íŠ¸ ë„êµ¬</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="StorageManager.accelerateTimeForTesting(); location.reload();" style="padding: 8px 15px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âš¡ ëª¨ë“  ë¬¸ì œ ë³µìŠµ ê°€ëŠ¥í•˜ê²Œ
                        </button>
                        <button onclick="console.log('ë§ê°ê³¡ì„  ë°ì´í„°:', StorageManager.getMistakes());" style="padding: 8px 15px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ” ì½˜ì†”ì—ì„œ ë°ì´í„° í™•ì¸
                        </button>
                        <button onclick="localStorage.removeItem('dasi_mistakes'); location.reload();" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ—‘ï¸ ë§ê°ê³¡ì„  ë°ì´í„° ì‚­ì œ
                        </button>
                    </div>
                </div>
            `;
        }

        // í†µê³„ ëª¨ë“œ í‘œì‹œ
        function showStatsMode() {
            levelsView.style.display = 'none';
            stageView.style.display = 'none';
            reviewView.style.display = 'none';
            forgettingCurveView.style.display = 'none';
            statsView.style.display = 'block';
            
            const stats = StorageManager.getUserStats();
            const mistakes = StorageManager.getMistakes();
            const dueReviews = StorageManager.getDueReviews();
            const masteredCount = mistakes.filter(m => m.mastered).length;
            
            // íŒ¨í„´ë³„ ì•½ì  ë¶„ì„
            const patternStats = {};
            mistakes.forEach(mistake => {
                if (!patternStats[mistake.pattern]) {
                    patternStats[mistake.pattern] = { count: 0, mastered: 0 };
                }
                patternStats[mistake.pattern].count++;
                if (mistake.mastered) patternStats[mistake.pattern].mastered++;
            });
            
            const statsContent = document.getElementById('stats-content');
            statsContent.innerHTML = `
                <!-- ì „ì²´ í†µê³„ ì¹´ë“œ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">${stats.totalSessions}</div>
                        <div style="opacity: 0.9;">ì´ í•™ìŠµ ì„¸ì…˜</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">${stats.totalQuestions}</div>
                        <div style="opacity: 0.9;">ì´ ë¬¸ì œ ìˆ˜</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">${stats.averageAccuracy}%</div>
                        <div style="opacity: 0.9;">í‰ê·  ì •í™•ë„</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;">${Math.round(stats.totalStudyTime / 60000)}</div>
                        <div style="opacity: 0.9;">ì´ í•™ìŠµ ì‹œê°„ (ë¶„)</div>
                    </div>
                </div>
                
                <!-- ë³µìŠµ ìƒíƒœ -->
                <div style="background: #f8fafc; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #1f2937; margin-bottom: 20px;">ğŸ§  ë³µìŠµ í˜„í™©</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; border-left: 4px solid #ef4444;">
                            <div style="font-size: 2em; font-weight: bold; color: #ef4444;">${mistakes.length}</div>
                            <div style="color: #6b7280; font-size: 14px;">ì´ í‹€ë¦° ë¬¸ì œ</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 2em; font-weight: bold; color: #f59e0b;">${dueReviews.length}</div>
                            <div style="color: #6b7280; font-size: 14px;">ë³µìŠµ ëŒ€ê¸°</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; border-left: 4px solid #10b981;">
                            <div style="font-size: 2em; font-weight: bold; color: #10b981;">${masteredCount}</div>
                            <div style="color: #6b7280; font-size: 14px;">ë§ˆìŠ¤í„° ì™„ë£Œ</div>
                        </div>
                    </div>
                </div>
                
                <!-- íŒ¨í„´ë³„ ì•½ì  ë¶„ì„ -->
                <div style="background: #fef3c7; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #92400e; margin-bottom: 20px;">ğŸ“Š íŒ¨í„´ë³„ ì•½ì  ë¶„ì„</h3>
                    ${Object.keys(patternStats).length > 0 ? `
                        <div style="display: grid; gap: 10px;">
                            ${Object.entries(patternStats).map(([pattern, data]) => {
                                const masteryRate = data.count > 0 ? Math.round((data.mastered / data.count) * 100) : 0;
                                const isWeak = masteryRate < 50;
                                return `
                                    <div style="background: white; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid ${isWeak ? '#ef4444' : '#10b981'};">
                                        <div>
                                            <strong style="color: #1f2937;">${pattern}</strong>
                                            <div style="font-size: 12px; color: #6b7280;">í‹€ë¦° íšŸìˆ˜: ${data.count}ë²ˆ</div>
                                        </div>
                                        <div style="text-align: right; display: flex; align-items: center; gap: 15px;">
                                            <div>
                                                <div style="font-size: 18px; font-weight: bold; color: ${isWeak ? '#ef4444' : '#10b981'};">
                                                    ${masteryRate}%
                                                </div>
                                                <div style="font-size: 12px; color: #6b7280;">ë§ˆìŠ¤í„°ìœ¨</div>
                                            </div>
                                            ${isWeak ? `
                                                <button onclick="startPatternTraining('${pattern}')" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">
                                                    ğŸ¯ ì§‘ì¤‘ í›ˆë ¨
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <!-- ì•½í•œ íŒ¨í„´ í•œë²ˆì— í›ˆë ¨ -->
                        ${Object.entries(patternStats).some(([_, data]) => data.count > 0 && Math.round((data.mastered / data.count) * 100) < 50) ? `
                            <div style="text-align: center; margin-top: 20px;">
                                <button onclick="startWeakPatternsTraining()" style="padding: 12px 25px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                                    ğŸ”¥ ì•½í•œ íŒ¨í„´ ëª¨ë‘ ì§‘ì¤‘ í›ˆë ¨í•˜ê¸°
                                </button>
                            </div>
                        ` : ''}
                    ` : `
                        <p style="color: #d97706; text-align: center;">ì•„ì§ ë¶„ì„í•  ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    `}
                </div>
                
                <!-- ê°œë°œì ë„êµ¬ -->
                <div style="background: #f1f5f9; padding: 20px; border-radius: 15px; border: 2px dashed #cbd5e1;">
                    <h3 style="color: #64748b; margin-bottom: 15px;">ğŸ› ï¸ ê°œë°œì ë„êµ¬</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="StorageManager.generateTestMistakes(); location.reload();" style="padding: 8px 15px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                        </button>
                        <button onclick="StorageManager.accelerateTimeForTesting(); location.reload();" style="padding: 8px 15px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âš¡ ì‹œê°„ ê°€ì†
                        </button>
                        <button onclick="localStorage.clear(); location.reload();" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ
                        </button>
                    </div>
                </div>
            `;
        }

        // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function showMainView() {
            levelsView.style.display = 'block';
            stageView.style.display = 'none';
            reviewView.style.display = 'none';
            statsView.style.display = 'none';
            forgettingCurveView.style.display = 'none';
            currentViewLevel = null;
            selectedStage = null;
        }

        // ë³µìŠµ/í†µê³„/ë§ê°ê³¡ì„  ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        reviewBtn.addEventListener('click', showReviewMode);
        statsBtn.addEventListener('click', showStatsMode);
        forgettingCurveBtn.addEventListener('click', showForgettingCurveMode);
        backFromReviewBtn.addEventListener('click', showMainView);
        backFromStatsBtn.addEventListener('click', showMainView);
        backFromCurveBtn.addEventListener('click', showMainView);

        // ê°œë³„ ë³µìŠµ ì‹œì‘ í•¨ìˆ˜ (ì „ì—­)
        window.startReviewQuestion = function(mistakeId) {
            const mistakes = StorageManager.getMistakes();
            const mistake = mistakes.find(m => m.id === mistakeId);
            
            if (!mistake) {
                alert('ë³µìŠµ ë¬¸ì œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // pattern-training.htmlë¡œ ë³µìŠµ ëª¨ë“œë¡œ ì—´ê¸°
            const params = new URLSearchParams({
                level: mistake.level,
                stage: mistake.stage,
                verbs: mistake.verb,
                reviewMode: 'single',
                reviewId: mistake.id
            });
            
            window.open(`pattern-training.html?${params.toString()}`, '_blank');
        };

        // ëª¨ë“  ë³µìŠµ ë¬¸ì œ ì‹œì‘ í•¨ìˆ˜ (ì „ì—­)
        window.startAllReview = function() {
            const dueReviews = StorageManager.getDueReviews();
            
            if (dueReviews.length === 0) {
                alert('ë³µìŠµí•  ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë³µìŠµ ë¬¸ì œë“¤ì˜ ID ëª©ë¡ ìƒì„±
            const reviewIds = dueReviews.map(mistake => mistake.id).join(',');
            
            // pattern-training.htmlë¡œ ì „ì²´ ë³µìŠµ ëª¨ë“œë¡œ ì—´ê¸°
            const params = new URLSearchParams({
                level: 'mixed',
                stage: 'review',
                reviewMode: 'all',
                reviewIds: reviewIds
            });
            
            window.open(`pattern-training.html?${params.toString()}`, '_blank');
        };

        // íŠ¹ì • íŒ¨í„´ ì§‘ì¤‘ í›ˆë ¨ í•¨ìˆ˜ (ì „ì—­)
        window.startPatternTraining = function(pattern) {
            const mistakes = StorageManager.getMistakes();
            const patternMistakes = mistakes.filter(m => m.pattern === pattern && !m.mastered);
            
            if (patternMistakes.length === 0) {
                alert('í•´ë‹¹ íŒ¨í„´ì— ëŒ€í•œ í›ˆë ¨ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const reviewIds = patternMistakes.map(mistake => mistake.id).join(',');
            
            // pattern-training.htmlë¡œ íŒ¨í„´ ì§‘ì¤‘ í›ˆë ¨ ëª¨ë“œë¡œ ì—´ê¸°
            const params = new URLSearchParams({
                level: 'pattern',
                stage: pattern,
                reviewMode: 'pattern',
                reviewIds: reviewIds,
                patternName: pattern
            });
            
            window.open(`pattern-training.html?${params.toString()}`, '_blank');
        };

        // ì•½í•œ íŒ¨í„´ ëª¨ë‘ ì§‘ì¤‘ í›ˆë ¨ í•¨ìˆ˜ (ì „ì—­)
        window.startWeakPatternsTraining = function() {
            const mistakes = StorageManager.getMistakes();
            
            // íŒ¨í„´ë³„ ì•½ì  ë¶„ì„
            const patternStats = {};
            mistakes.forEach(mistake => {
                if (!patternStats[mistake.pattern]) {
                    patternStats[mistake.pattern] = { count: 0, mastered: 0 };
                }
                patternStats[mistake.pattern].count++;
                if (mistake.mastered) patternStats[mistake.pattern].mastered++;
            });
            
            // ë§ˆìŠ¤í„°ìœ¨ 50% ë¯¸ë§Œì¸ íŒ¨í„´ë“¤ì˜ ë¬¸ì œë§Œ ìˆ˜ì§‘
            const weakPatternMistakes = [];
            Object.entries(patternStats).forEach(([pattern, data]) => {
                const masteryRate = data.count > 0 ? Math.round((data.mastered / data.count) * 100) : 0;
                if (masteryRate < 50) {
                    const patternMistakes = mistakes.filter(m => m.pattern === pattern && !m.mastered);
                    weakPatternMistakes.push(...patternMistakes);
                }
            });
            
            if (weakPatternMistakes.length === 0) {
                alert('ì•½í•œ íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤! ëª¨ë“  íŒ¨í„´ì´ ì–‘í˜¸í•œ ìƒíƒœì…ë‹ˆë‹¤.');
                return;
            }
            
            const reviewIds = weakPatternMistakes.map(mistake => mistake.id).join(',');
            
            // pattern-training.htmlë¡œ ì•½í•œ íŒ¨í„´ ì§‘ì¤‘ í›ˆë ¨ ëª¨ë“œë¡œ ì—´ê¸°
            const params = new URLSearchParams({
                level: 'weak-patterns',
                stage: 'mixed',
                reviewMode: 'weak-patterns',
                reviewIds: reviewIds
            });
            
            window.open(`pattern-training.html?${params.toString()}`, '_blank');
        };

        // ì´ˆê¸°í™”
        createLevelCards();
        updateUserStats();
        
        // ì •ê¸°ì ìœ¼ë¡œ ë³µìŠµ ìƒíƒœ ì—…ë°ì´íŠ¸ (1ë¶„ë§ˆë‹¤)
        setInterval(updateUserStats, 60000);
        
        // ì²« ë²ˆì§¸ ìŠ¤í…Œì´ì§€ ì„ íƒ (ìŠ¤í…Œì´ì§€ ë·°ê°€ ì—´ë ¸ì„ ë•Œë§Œ)
        setTimeout(() => {
            if (currentViewLevel && stageView.style.display !== 'none') {
                const userLevelData = userProgress.levels.find(l => l.level === currentViewLevel);
                if (userLevelData?.stages) {
                    // ì§„í–‰ì¤‘ì¸ ìŠ¤í…Œì´ì§€ ì°¾ê¸°
                    let targetStage = userLevelData.stages.findIndex(s => !s.completed) + 1;
                    if (targetStage === 0) targetStage = 1; // ëª¨ë“  ìŠ¤í…Œì´ì§€ê°€ ì™„ë£Œëœ ê²½ìš°
                    selectStage(currentViewLevel, targetStage);
                } else {
                    selectStage(currentViewLevel, 1);
                }
            }
        }, 500);
    </script>
</body>
</html>
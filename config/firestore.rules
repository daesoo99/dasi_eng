rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // User data - owner access only
    match /users/{uid} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
    
    // Curriculum data - authenticated read only
    match /curriculum/{document=**} {
      allow read: if request.auth != null;
      allow write: if false; // Admin only via server
    }
    
    // Pattern data - authenticated read only
    match /patterns/{document=**} {
      allow read: if request.auth != null;
      allow write: if false; // Admin only via server
    }
    
    // User progress - owner access only
    match /progress/{uid}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
    
    // User sessions - owner access only
    match /sessions/{uid}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
    
    // Meta configuration - authenticated read only
    match /meta/{document} {
      allow read: if request.auth != null;
      allow write: if false; // Admin only via server
    }
    
    // Block everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASI English - Level 3 Speaking ì—°ìŠµ</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            background: linear-gradient(135deg, #7c3aed, #c026d3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .stage-info {
            background: linear-gradient(135deg, #f3e5f5, #e8f5e8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #7c3aed;
        }
        
        .phase-indicator {
            display: inline-block;
            background: #7c3aed;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .grammar-pattern {
            background: #fef3c7;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1em;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .stage-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        .stage-btn {
            padding: 15px 25px;
            border: 3px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .stage-btn.active {
            border-color: #7c3aed;
            background: #7c3aed;
            color: white;
        }
        .stage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #7c3aed, #c026d3);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .question-area {
            text-align: center;
            margin: 40px 0;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .korean-text {
            font-size: 2.5em;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .english-answer {
            font-size: 2em;
            color: #7c3aed;
            font-weight: 600;
            min-height: 50px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .english-answer.show {
            opacity: 1;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        .control-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        .start-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .pause-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .reset-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .control-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #7c3aed;
        }
        .stat-label {
            color: #64748b;
            margin-top: 5px;
        }

        .timer-circle {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #7c3aed;
            border-radius: 50%;
            margin: 0 auto;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ìŒì„± ì¸ì‹ ì˜ì—­ */
        #speech-test-area {
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            border: 2px dashed #7c3aed;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        #mic-status {
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        #mic-status.listening {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        #speech-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            min-height: 50px;
            font-size: 18px;
            text-align: center;
            margin: 15px 0;
        }

        #answer-evaluation {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        .correct {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .incorrect {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.close()">â† ëŒì•„ê°€ê¸°</button>
    
    <div class="container">
        <h1>ğŸ¯ Level 3 Speaking</h1>
        <p class="subtitle">ê³ ê¸‰ ë¬¸ë²• íŒ¨í„´ - í•œêµ­ì–´ ë“£ê³  ì˜ì–´ë¡œ ë§í•˜ê¸°</p>
        
        <div class="stage-info">
            <div class="phase-indicator" id="phase-indicator">Phase 1</div>
            <h3 id="stage-title" style="color: #1f2937; margin: 10px 0;">ìŠ¤í…Œì´ì§€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
            <div class="grammar-pattern" id="grammar-pattern">ë¬¸ë²• íŒ¨í„´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <!-- ë‹¨ê³„ ì„ íƒ -->
        <div class="stage-selector">
            <div class="stage-btn active" data-stage="1">
                1ë‹¨ê³„<br><small>ìˆœì„œëŒ€ë¡œ (3ì´ˆ)</small>
            </div>
            <div class="stage-btn" data-stage="2">
                2ë‹¨ê³„<br><small>ì¡°ê¸ˆ ì„ê¸° (2ì´ˆ)</small>
            </div>
            <div class="stage-btn" data-stage="3">
                3ë‹¨ê³„<br><small>ì™„ì „ ì„ê¸° (1ì´ˆ)</small>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- ì§ˆë¬¸ ì˜ì—­ -->
        <div class="question-area">
            <div class="korean-text" id="korean-text">í•œêµ­ì–´ë¥¼ ë“£ê³  ì˜ì–´ë¡œ ë§í•´ë³´ì„¸ìš”</div>
            <div class="english-answer" id="english-answer"></div>
            <div class="timer-circle" id="timer"></div>
            
            <!-- ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="speech-test-area">
                <div style="text-align: center; margin-bottom: 15px;">
                    <div id="countdown-timer" style="font-size: 24px; font-weight: bold; color: #ef4444; margin-bottom: 10px;">
                        3ì´ˆ í›„ ìŒì„± ì¸ì‹ ì‹œì‘...
                    </div>
                    <div id="mic-status">
                        ğŸ¤ ì¤€ë¹„ ì¤‘...
                    </div>
                </div>
                <div id="speech-result">
                    ì ì‹œ í›„ ìë™ìœ¼ë¡œ ìŒì„± ì¸ì‹ì´ ì‹œì‘ë©ë‹ˆë‹¤
                </div>
                <div id="answer-evaluation" style="display: none;">
                </div>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ -->
        <div class="controls">
            <button class="control-btn start-btn" id="start-btn">ğŸš€ ì‹œì‘í•˜ê¸°</button>
            <button class="control-btn pause-btn" id="pause-btn" disabled>â¸ï¸ ì¼ì‹œì •ì§€</button>
            <button class="control-btn reset-btn" id="reset-btn">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
        </div>

        <!-- í†µê³„ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="current-question">0</div>
                <div class="stat-label">í˜„ì¬ ë¬¸ì œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-questions">0</div>
                <div class="stat-label">ì „ì²´ ë¬¸ì œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completion-rate">0%</div>
                <div class="stat-label">ì™„ë£Œìœ¨</div>
            </div>
        </div>
    </div>

    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìŠ¤í…Œì´ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const stageNumber = parseInt(urlParams.get('stage')) || 1;
        
        // Level 3 ìŠ¤í…Œì´ì§€ ë°ì´í„°
        let stageData = null;
        let currentQuestions = [];
        let currentIndex = 0;
        let isRunning = false;
        let isPaused = false;
        let currentStage = 1;
        
        // ê¸€ë¡œë²Œ íƒ€ì´ë¨¸ ë³€ìˆ˜ë“¤ (ì¼ì‹œì •ì§€ ê¸°ëŠ¥ì„ ìœ„í•œ)
        let remainingCountdownTime = 0;
        let remainingRecognitionTime = 0;
        let remainingWaitTime = 0;
        let currentCountdownInterval = null;
        let currentRecognitionCountdown = null;
        let currentWaitTimeout = null;
        let currentPhase = 'idle'; // 'tts', 'countdown', 'recognition', 'waiting', 'idle'
        
        // Level 3 JSON ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œ
        async function loadLevel3Data() {
            try {
                const response = await fetch('/patterns/level_3_advanced_grammar/lv3_stage_system.json');
                const data = await response.json();
                
                stageData = data.stages.find(stage => stage.stage === stageNumber);
                if (!stageData) {
                    throw new Error(`Stage ${stageNumber} not found`);
                }
                
                initializeStage();
            } catch (error) {
                console.error('Level 3 ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                // ê°œë°œì ëª¨ë“œ ë˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ ë°ì´í„°
                loadDummyData();
            }
        }
        
        // í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°
        function loadDummyData() {
            stageData = {
                stage: stageNumber,
                phase: 1,
                title: "ë¯¸ë˜í˜• ì‹¬í™” (will vs be going to)",
                grammar_focus: "ì˜ë„/ê³„íš vs ì˜ˆì¸¡/ì¦‰ì„ ê²°ì •ì˜ êµ¬ë¶„",
                patterns: [
                    "I'm going to + [ë™ì‚¬ì›í˜•] (ê³„íš)",
                    "I will + [ë™ì‚¬ì›í˜•] (ì¦‰ì„ ê²°ì •)",
                    "It's going to + [ë™ì‚¬ì›í˜•] (ì˜ˆì¸¡)"
                ],
                sentence_variations: {
                    planned_actions: [
                        {"en": "I'm going to study abroad next year", "ko": "ë‚˜ëŠ” ë‚´ë…„ì— ìœ í•™ê°ˆ ì˜ˆì •ì´ì•¼"},
                        {"en": "We're going to move to Seoul", "ko": "ìš°ë¦¬ëŠ” ì„œìš¸ë¡œ ì´ì‚¬í•  ì˜ˆì •ì´ì•¼"},
                        {"en": "She's going to change her job", "ko": "ê·¸ë…€ëŠ” ì§ì—…ì„ ë°”ê¿€ ì˜ˆì •ì´ì•¼"},
                        {"en": "They're going to buy a new car", "ko": "ê·¸ë“¤ì€ ìƒˆ ì°¨ë¥¼ ì‚´ ì˜ˆì •ì´ì•¼"},
                        {"en": "He's going to learn English", "ko": "ê·¸ëŠ” ì˜ì–´ë¥¼ ë°°ìš¸ ì˜ˆì •ì´ì•¼"}
                    ],
                    spontaneous_decisions: [
                        {"en": "I will help you with that", "ko": "ê·¸ê²ƒ ë„ì™€ì¤„ê²Œ"},
                        {"en": "We will call you later", "ko": "ë‚˜ì¤‘ì— ì „í™”í• ê²Œ"},
                        {"en": "She will answer the phone", "ko": "ê·¸ë…€ê°€ ì „í™”ë¥¼ ë°›ì„ê²Œ"},
                        {"en": "They will fix this problem", "ko": "ê·¸ë“¤ì´ ì´ ë¬¸ì œë¥¼ í•´ê²°í• ê²Œ"},
                        {"en": "He will drive you home", "ko": "ê·¸ê°€ ì§‘ê¹Œì§€ ë°ë ¤ë‹¤ì¤„ê²Œ"}
                    ],
                    predictions: [
                        {"en": "It's going to rain tomorrow", "ko": "ë‚´ì¼ ë¹„ê°€ ì˜¬ ê²ƒ ê°™ì•„"},
                        {"en": "The meeting is going to be long", "ko": "íšŒì˜ê°€ ê¸¸ì–´ì§ˆ ê²ƒ ê°™ì•„"},
                        {"en": "This project is going to succeed", "ko": "ì´ í”„ë¡œì íŠ¸ëŠ” ì„±ê³µí•  ê²ƒ ê°™ì•„"},
                        {"en": "The test is going to be difficult", "ko": "ì‹œí—˜ì´ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„"},
                        {"en": "Traffic is going to be heavy", "ko": "êµí†µì´ ë§‰í ê²ƒ ê°™ì•„"}
                    ]
                }
            };
            
            initializeStage();
        }
        
        // ìŠ¤í…Œì´ì§€ ì´ˆê¸°í™”
        function initializeStage() {
            // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('stage-title').textContent = `Stage ${stageNumber}: ${stageData.title}`;
            document.getElementById('phase-indicator').textContent = `Phase ${stageData.phase}`;
            document.getElementById('grammar-pattern').textContent = stageData.patterns ? stageData.patterns.join(' / ') : 'ê³ ê¸‰ ë¬¸ë²• íŒ¨í„´';
            
            // ëª¨ë“  ë¬¸ì¥ ë³€í˜•ì„ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ í•©ì¹˜ê¸°
            currentQuestions = [];
            Object.values(stageData.sentence_variations).forEach(variations => {
                currentQuestions.push(...variations);
            });
            
            // ì´ ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('total-questions').textContent = currentQuestions.length;
            updateProgress();
            
            console.log(`Level 3 Stage ${stageNumber} ë¡œë“œ ì™„ë£Œ: ${currentQuestions.length}ê°œ ë¬¸ì œ`);
        }
        
        // ë‹¨ê³„ ì„ íƒ
        document.querySelectorAll('.stage-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelector('.stage-btn.active').classList.remove('active');
                btn.classList.add('active');
                currentStage = parseInt(btn.dataset.stage);
                resetTraining();
            });
        });
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const progress = currentQuestions.length > 0 ? (currentIndex / currentQuestions.length) * 100 : 0;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('current-question').textContent = currentIndex + 1;
            document.getElementById('completion-rate').textContent = Math.round(progress) + '%';
        }
        
        // ì§ˆë¬¸ ì„ê¸° (ë‹¨ê³„ë³„)
        function shuffleQuestions() {
            if (currentStage === 1) {
                // 1ë‹¨ê³„: ìˆœì„œëŒ€ë¡œ
                return [...currentQuestions];
            } else if (currentStage === 2) {
                // 2ë‹¨ê³„: ì¡°ê¸ˆ ì„ê¸°
                const shuffled = [...currentQuestions];
                for (let i = shuffled.length - 1; i > 0; i -= 2) {
                    const j = Math.max(0, i - 1);
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            } else {
                // 3ë‹¨ê³„: ì™„ì „ ì„ê¸°
                const shuffled = [...currentQuestions];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
        }
        
        // í›ˆë ¨ ì‹œì‘
        function startTraining() {
            if (isRunning && !isPaused) return;
            
            if (!isRunning) {
                currentQuestions = shuffleQuestions();
                currentIndex = 0;
                currentPhase = 'idle';
            }
            
            isRunning = true;
            isPaused = false;
            
            document.getElementById('start-btn').disabled = true;
            document.getElementById('pause-btn').disabled = false;
            
            // ì¼ì‹œì •ì§€ì—ì„œ ì¬ê°œí•˜ëŠ” ê²½ìš°
            if (currentPhase === 'countdown' && remainingCountdownTime > 0) {
                console.log(`â–¶ï¸ [${new Date().toLocaleTimeString()}] ì¹´ìš´íŠ¸ë‹¤ìš´ ì¬ê°œ - ${remainingCountdownTime}ì´ˆ ë‚¨ìŒ`);
                resumeCountdown();
            } else if (currentPhase === 'recognition' && remainingRecognitionTime > 0) {
                console.log(`â–¶ï¸ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì¬ê°œ - ${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`);
                resumeRecognition();
            } else if (currentPhase === 'waiting' && remainingWaitTime > 0) {
                console.log(`â–¶ï¸ [${new Date().toLocaleTimeString()}] ëŒ€ê¸°ì‹œê°„ ì¬ê°œ - ${remainingWaitTime}ì´ˆ ë‚¨ìŒ`);
                resumeWaiting();
            } else {
                showNextQuestion();
            }
        }
        
        // ì¹´ìš´íŠ¸ë‹¤ìš´ ì¬ê°œ
        function resumeCountdown() {
            const countdownTimer = document.getElementById('countdown-timer');
            
            currentCountdownInterval = setInterval(() => {
                remainingCountdownTime--;
                console.log(`â³ [${new Date().toLocaleTimeString()}] ì‚¬ê³ ì‹œê°„ ë‚¨ìŒ: ${remainingCountdownTime}ì´ˆ`);
                countdownTimer.textContent = `${remainingCountdownTime}ì´ˆ í›„ ìŒì„± ì¸ì‹ ì‹œì‘...`;
                
                if (remainingCountdownTime <= 0) {
                    clearInterval(currentCountdownInterval);
                    currentCountdownInterval = null;
                    currentPhase = 'recognition';
                    countdownTimer.textContent = 'ì§€ê¸ˆ ì˜ì–´ë¡œ ë§í•´ì£¼ì„¸ìš”!';
                    console.log(`ğŸ”” [${new Date().toLocaleTimeString()}] ì‚¬ê³ ì‹œê°„ ì¢…ë£Œ - ë§ˆì´í¬ ì‹œì‘ìŒ ì¬ìƒ`);
                    
                    // ë§ˆì´í¬ ì‹œì‘ ì†Œë¦¬ ì¬ìƒ
                    playMicrophoneStartSound();
                    
                    // ì‹¤ì œ ìŒì„± ì¸ì‹ ì‹œì‘
                    setTimeout(() => {
                        const currentQuestion = currentQuestions[currentIndex];
                        if ('webkitSpeechRecognition' in window) {
                            startWebSpeechRecognition(currentQuestion.en);
                        } else {
                            simulateSpeechRecognition(currentQuestion.en);
                        }
                    }, 200);
                }
            }, 1000);
        }
        
        // ìŒì„±ì¸ì‹ ì¬ê°œ
        function resumeRecognition() {
            const countdownTimer = document.getElementById('countdown-timer');
            const speechTestArea = document.getElementById('speech-test-area');
            const micStatus = document.getElementById('mic-status');
            const speechResult = document.getElementById('speech-result');
            
            // UI ë³µì›
            speechTestArea.style.display = 'block';
            micStatus.textContent = 'ğŸ¤ ë“£ê³  ìˆìŠµë‹ˆë‹¤...';
            micStatus.classList.add('listening');
            speechResult.textContent = 'ìŒì„±ì„ ì¸ì‹í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            
            countdownTimer.textContent = `${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`;
            countdownTimer.style.color = remainingRecognitionTime <= 3 ? '#ef4444' : remainingRecognitionTime <= 5 ? '#f59e0b' : '#10b981';
            
            currentRecognitionCountdown = setInterval(() => {
                remainingRecognitionTime--;
                console.log(`â±ï¸ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ë‚¨ì€ì‹œê°„: ${remainingRecognitionTime}ì´ˆ`);
                
                if (remainingRecognitionTime > 0) {
                    countdownTimer.textContent = `${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`;
                    
                    if (remainingRecognitionTime <= 3) {
                        countdownTimer.style.color = '#ef4444';
                    } else if (remainingRecognitionTime <= 5) {
                        countdownTimer.style.color = '#f59e0b';
                    }
                } else {
                    clearInterval(currentRecognitionCountdown);
                    currentRecognitionCountdown = null;
                    currentPhase = 'idle';
                    countdownTimer.textContent = 'ì‹œê°„ ì¢…ë£Œ!';
                    countdownTimer.style.color = '#ef4444';
                    
                    // ì‹œê°„ ì´ˆê³¼ ì²˜ë¦¬
                    speechResult.textContent = 'ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    setTimeout(() => {
                        nextQuestion();
                    }, 2000);
                }
            }, 1000);
            
            // ìƒˆë¡œìš´ ìŒì„± ì¸ì‹ ì‹œì‘
            const currentQuestion = currentQuestions[currentIndex];
            if ('webkitSpeechRecognition' in window) {
                startWebSpeechRecognition(currentQuestion.en);
            }
        }
        
        // ëŒ€ê¸°ì‹œê°„ ì¬ê°œ
        function resumeWaiting() {
            const countdownTimer = document.getElementById('countdown-timer');
            
            countdownTimer.textContent = `${remainingWaitTime}ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œ`;
            countdownTimer.style.color = '#10b981';
            
            currentWaitTimeout = setInterval(() => {
                remainingWaitTime--;
                console.log(`â±ï¸ [${new Date().toLocaleTimeString()}] ë‹¤ìŒ ë¬¸ì œê¹Œì§€ ${remainingWaitTime}ì´ˆ ë‚¨ìŒ`);
                
                if (remainingWaitTime > 0) {
                    countdownTimer.textContent = `${remainingWaitTime}ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œ`;
                } else {
                    clearInterval(currentWaitTimeout);
                    currentWaitTimeout = null;
                    currentPhase = 'idle';
                    nextQuestion();
                }
            }, 1000);
        }
        
        // ë‹¤ìŒ ì§ˆë¬¸ í‘œì‹œ
        function showNextQuestion() {
            if (!isRunning || isPaused) return;
            
            if (currentIndex >= currentQuestions.length) {
                completeTraining();
                return;
            }
            
            const question = currentQuestions[currentIndex];
            const koreanText = document.getElementById('korean-text');
            const englishAnswer = document.getElementById('english-answer');
            const speechTestArea = document.getElementById('speech-test-area');
            
            // í•œêµ­ì–´ í…ìŠ¤íŠ¸ í‘œì‹œ (ì„ íƒì )
            koreanText.textContent = question.ko;
            englishAnswer.classList.remove('show');
            speechTestArea.style.display = 'none';
            
            // í•œêµ­ì–´ TTS ì¬ìƒ
            if ('speechSynthesis' in window) {
                const koreanUtterance = new SpeechSynthesisUtterance(question.ko);
                koreanUtterance.lang = 'ko-KR';
                koreanUtterance.rate = 0.8;
                speechSynthesis.speak(koreanUtterance);
            }
            
            // íƒ€ì´ë¨¸ í‘œì‹œ
            const timer = document.getElementById('timer');
            timer.style.display = 'block';
            
            const delay = currentStage === 1 ? 3000 : currentStage === 2 ? 2000 : 1000;
            
            setTimeout(() => {
                if (!isRunning || isPaused) return;
                
                timer.style.display = 'none';
                
                // ìŒì„± ì¸ì‹ ì‹œì‘ (ì‚¬ìš©ìê°€ ì˜ì–´ë¡œ ë‹µë³€)
                startSpeechRecognition(question.en);
                
            }, delay);
            
            updateProgress();
        }
        
        // ìŒì„± ì¸ì‹ ì‹œì‘
        function startSpeechRecognition(correctAnswer) {
            const speechTestArea = document.getElementById('speech-test-area');
            const micStatus = document.getElementById('mic-status');
            const speechResult = document.getElementById('speech-result');
            const answerEvaluation = document.getElementById('answer-evaluation');
            const countdownTimer = document.getElementById('countdown-timer');
            
            speechTestArea.style.display = 'block';
            answerEvaluation.style.display = 'none';
            
            // ë‹¨ê³„ë³„ ì¹´ìš´íŠ¸ë‹¤ìš´ (1ë‹¨ê³„:3ì´ˆ, 2ë‹¨ê³„:2ì´ˆ, 3ë‹¨ê³„:1ì´ˆ)
            const waitTime = currentStage === 1 ? 3 : currentStage === 2 ? 2 : 1;
            console.log(`â³ [${new Date().toLocaleTimeString()}] ì‚¬ê³ ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘ - ${waitTime}ì´ˆ ëŒ€ê¸°`);
            
            // í˜„ì¬ ë‹¨ê³„ë¥¼ countdownìœ¼ë¡œ ì„¤ì •
            currentPhase = 'countdown';
            remainingCountdownTime = waitTime;
            
            currentCountdownInterval = setInterval(() => {
                remainingCountdownTime--;
                console.log(`â³ [${new Date().toLocaleTimeString()}] ì‚¬ê³ ì‹œê°„ ë‚¨ìŒ: ${remainingCountdownTime}ì´ˆ`);
                countdownTimer.textContent = `${remainingCountdownTime}ì´ˆ í›„ ìŒì„± ì¸ì‹ ì‹œì‘...`;
                
                if (remainingCountdownTime <= 0) {
                    clearInterval(currentCountdownInterval);
                    currentCountdownInterval = null;
                    currentPhase = 'recognition';
                    countdownTimer.textContent = 'ì§€ê¸ˆ ì˜ì–´ë¡œ ë§í•´ì£¼ì„¸ìš”!';
                    console.log(`ğŸ”” [${new Date().toLocaleTimeString()}] ì‚¬ê³ ì‹œê°„ ì¢…ë£Œ - ë§ˆì´í¬ ì‹œì‘ìŒ ì¬ìƒ`);
                    
                    // ë§ˆì´í¬ ì‹œì‘ ì†Œë¦¬ ì¬ìƒ
                    playMicrophoneStartSound();
                    
                    // ì‹¤ì œ ìŒì„± ì¸ì‹ ì‹œì‘
                    setTimeout(() => {
                        console.log(`ğŸ¤ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ í•¨ìˆ˜ í˜¸ì¶œ ì‹œì‘`);
                        if ('webkitSpeechRecognition' in window) {
                            startWebSpeechRecognition(correctAnswer);
                        } else {
                            // ìŒì„± ì¸ì‹ ë¯¸ì§€ì› ì‹œ ì‹œë®¬ë ˆì´ì…˜
                            simulateSpeechRecognition(correctAnswer);
                        }
                    }, 200); // ë¹„í”„ìŒ ì¬ìƒ í›„ ì•½ê°„ì˜ ë”œë ˆì´
                }
            }, 1000);
        }
        
        // ë§ˆì´í¬ ì‹œì‘ ì†Œë¦¬ ì¬ìƒ
        function playMicrophoneStartSound() {
            // Web Audio APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì§§ì€ ë¹„í”„ìŒ ìƒì„±
            if ('AudioContext' in window || 'webkitAudioContext' in window) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime); // 800Hz í†¤
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); // 30% ë³¼ë¥¨
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2); // 0.2ì´ˆ í˜ì´ë“œì•„ì›ƒ
                
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.2);
            }
        }
        
        // ì›¹ ìŒì„± ì¸ì‹
        function startWebSpeechRecognition(correctAnswer) {
            const startTime = Date.now();
            console.log(`ğŸ¤ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì‹œì‘ - 6ì´ˆ ì œí•œì‹œê°„`);
            
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.maxAlternatives = 5;
            
            // ìŒì„±ì¸ì‹ ì •í™•ë„ ê°œì„  ì„¤ì •  
            if (recognition.serviceURI) {
                recognition.serviceURI = 'wss://www.google.com/speech-api/v2/recognize';
            }
            
            const micStatus = document.getElementById('mic-status');
            const speechResult = document.getElementById('speech-result');
            const answerEvaluation = document.getElementById('answer-evaluation');
            const countdownTimer = document.getElementById('countdown-timer');
            
            micStatus.textContent = 'ğŸ¤ ë“£ê³  ìˆìŠµë‹ˆë‹¤...';
            micStatus.classList.add('listening');
            speechResult.textContent = 'ìŒì„±ì„ ì¸ì‹í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            
            // ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘ (6ì´ˆ)
            remainingRecognitionTime = 6;
            countdownTimer.textContent = `${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`;
            countdownTimer.style.color = '#10b981'; // ì´ˆë¡ìƒ‰
            
            currentRecognitionCountdown = setInterval(() => {
                remainingRecognitionTime--;
                console.log(`â±ï¸ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ë‚¨ì€ì‹œê°„: ${remainingRecognitionTime}ì´ˆ`);
                
                if (remainingRecognitionTime > 0) {
                    countdownTimer.textContent = `${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`;
                    
                    // ì‹œê°„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                    if (remainingRecognitionTime <= 3) {
                        countdownTimer.style.color = '#ef4444'; // ë¹¨ê°„ìƒ‰
                    } else if (remainingRecognitionTime <= 5) {
                        countdownTimer.style.color = '#f59e0b'; // ë…¸ë€ìƒ‰
                    }
                } else {
                    clearInterval(currentRecognitionCountdown);
                    currentRecognitionCountdown = null;
                    countdownTimer.textContent = 'ì‹œê°„ ì¢…ë£Œ!';
                    countdownTimer.style.color = '#ef4444';
                }
            }, 1000);
            
            let isCompleted = false;
            
            recognition.onresult = function(event) {
                if (isCompleted) return;
                isCompleted = true;
                
                const endTime = Date.now();
                const responseTime = (endTime - startTime) / 1000;
                
                const userSpeech = event.results[0][0].transcript;
                console.log(`âœ… [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì™„ë£Œ - ì‘ë‹µì‹œê°„: ${responseTime.toFixed(1)}ì´ˆ`);
                console.log(`ğŸ“ [${new Date().toLocaleTimeString()}] ì¸ì‹ëœ ìŒì„±: "${userSpeech}"`);
                
                if (currentRecognitionCountdown) {
                    clearInterval(currentRecognitionCountdown);
                    currentRecognitionCountdown = null;
                }
                currentPhase = 'idle';
                
                speechResult.textContent = `ì¸ì‹ëœ ìŒì„±: "${userSpeech}"`;
                countdownTimer.textContent = `ì‘ë‹µì‹œê°„: ${responseTime.toFixed(1)}ì´ˆ`;
                countdownTimer.style.color = '#10b981';
                
                evaluateAnswer(userSpeech, correctAnswer);
            };
            
            recognition.onerror = function(event) {
                if (isCompleted) return;
                isCompleted = true;
                
                console.log(`âŒ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì˜¤ë¥˜: ${event.error}`);
                if (currentRecognitionCountdown) {
                    clearInterval(currentRecognitionCountdown);
                    currentRecognitionCountdown = null;
                }
                currentPhase = 'idle';
                
                speechResult.textContent = 'ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            };
            
            recognition.onend = function() {
                micStatus.classList.remove('listening');
                console.log(`ğŸ”‡ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì¢…ë£Œ`);
            };
            
            recognition.start();
            
            // 10ì´ˆ í›„ ìë™ ì¢…ë£Œ
            setTimeout(() => {
                if (isCompleted) return;
                isCompleted = true;
                
                console.log(`â° [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ ì‹œê°„ì´ˆê³¼ (6ì´ˆ)`);
                recognition.stop();
                if (currentRecognitionCountdown) {
                    clearInterval(currentRecognitionCountdown);
                    currentRecognitionCountdown = null;
                }
                currentPhase = 'idle';
                
                if (speechResult.textContent.includes('ì¸ì‹í•˜ê³  ìˆìŠµë‹ˆë‹¤')) {
                    speechResult.textContent = 'ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    countdownTimer.textContent = 'ì‹œê°„ ì´ˆê³¼!';
                    countdownTimer.style.color = '#ef4444';
                    
                    setTimeout(() => {
                        nextQuestion();
                    }, 2000);
                }
            }, 6000); // 6ì´ˆë¡œ ì œí•œ
        }
        
        // ìŒì„± ì¸ì‹ ì‹œë®¬ë ˆì´ì…˜
        function simulateSpeechRecognition(correctAnswer) {
            const micStatus = document.getElementById('mic-status');
            const speechResult = document.getElementById('speech-result');
            
            micStatus.textContent = 'ğŸ¤ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ';
            speechResult.textContent = 'ìŒì„± ì¸ì‹ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            
            setTimeout(() => {
                const simulatedAnswer = correctAnswer; // ì‹œë®¬ë ˆì´ì…˜ì—ì„œëŠ” ì •ë‹µìœ¼ë¡œ ê°€ì •
                speechResult.textContent = `ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼: "${simulatedAnswer}"`;
                evaluateAnswer(simulatedAnswer, correctAnswer);
            }, 3000);
        }
        
        // ë‹µë³€ í‰ê°€
        function evaluateAnswer(userAnswer, correctAnswer) {
            const answerEvaluation = document.getElementById('answer-evaluation');
            const englishAnswer = document.getElementById('english-answer');
            const countdownTimer = document.getElementById('countdown-timer');
            
            // ì •ë‹µ í‘œì‹œ
            englishAnswer.textContent = correctAnswer;
            englishAnswer.classList.add('show');
            
            // ì˜ì–´ ì •ë‹µ TTS ì¬ìƒ
            if ('speechSynthesis' in window) {
                const englishUtterance = new SpeechSynthesisUtterance(correctAnswer);
                englishUtterance.lang = 'en-US';
                englishUtterance.rate = 0.8;
                speechSynthesis.speak(englishUtterance);
            }
            
            // ê°„ë‹¨í•œ ìœ ì‚¬ë„ ê²€ì‚¬
            const similarity = calculateSimilarity(userAnswer.toLowerCase(), correctAnswer.toLowerCase());
            
            answerEvaluation.style.display = 'block';
            
            if (similarity > 0.8) {
                answerEvaluation.className = 'correct';
                answerEvaluation.textContent = 'ğŸ‰ í›Œë¥­í•©ë‹ˆë‹¤! ì •í™•í•œ ë°œìŒì´ì—ìš”.';
            } else if (similarity > 0.6) {
                answerEvaluation.className = 'correct';
                answerEvaluation.textContent = 'âœ… ì¢‹ì•„ìš”! ì¡°ê¸ˆ ë” ì—°ìŠµí•˜ë©´ ì™„ë²½í•´ìš”.';
            } else {
                answerEvaluation.className = 'incorrect';
                answerEvaluation.textContent = `âŒ ë‹¤ì‹œ í•œë²ˆ! ì •ë‹µ: "${correctAnswer}"`;
            }
            
            // Phaseë¥¼ waitingìœ¼ë¡œ ì„¤ì •í•˜ê³  4ì´ˆ ëŒ€ê¸°
            currentPhase = 'waiting';
            remainingWaitTime = 4;
            
            console.log(`â±ï¸ [${new Date().toLocaleTimeString()}] ë‹µë³€ í‰ê°€ ì™„ë£Œ - 4ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™`);
            countdownTimer.textContent = `${remainingWaitTime}ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œ`;
            countdownTimer.style.color = '#10b981';
            
            // 1ì´ˆë§ˆë‹¤ ì¹´ìš´íŠ¸ë‹¤ìš´
            const waitInterval = setInterval(() => {
                remainingWaitTime--;
                console.log(`â±ï¸ [${new Date().toLocaleTimeString()}] ë‹¤ìŒ ë¬¸ì œê¹Œì§€ ${remainingWaitTime}ì´ˆ ë‚¨ìŒ`);
                
                if (remainingWaitTime > 0) {
                    countdownTimer.textContent = `${remainingWaitTime}ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œ`;
                } else {
                    clearInterval(waitInterval);
                    currentPhase = 'idle';
                    nextQuestion();
                }
            }, 1000);
            
            // ê¸€ë¡œë²Œ ë³€ìˆ˜ì— ì €ì¥í•˜ì—¬ ì¼ì‹œì •ì§€ ì‹œ ê´€ë¦¬ ê°€ëŠ¥í•˜ë„ë¡
            currentWaitTimeout = waitInterval;
        }
        
        // ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚°
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const distance = levenshteinDistance(longer, shorter);
            return (longer.length - distance) / longer.length;
        }
        
        // ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ ê³„ì‚°
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }
        
        // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ
        function nextQuestion() {
            currentIndex++;
            
            setTimeout(() => {
                showNextQuestion();
            }, 1000);
        }
        
        // í›ˆë ¨ ì¼ì‹œì •ì§€
        function pauseTraining() {
            if (!isRunning) return;
            
            console.log(`â¸ï¸ [${new Date().toLocaleTimeString()}] ì¼ì‹œì •ì§€ - í˜„ì¬ Phase: ${currentPhase}`);
            
            isPaused = true;
            
            // ëª¨ë“  íƒ€ì´ë¨¸ ì¤‘ë‹¨
            if (currentCountdownInterval) {
                clearInterval(currentCountdownInterval);
                currentCountdownInterval = null;
                console.log(`â¸ï¸ [${new Date().toLocaleTimeString()}] ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ ì¤‘ë‹¨ - ë‚¨ì€ ì‹œê°„: ${remainingCountdownTime}ì´ˆ`);
            }
            
            if (currentRecognitionCountdown) {
                clearInterval(currentRecognitionCountdown);
                currentRecognitionCountdown = null;
                console.log(`â¸ï¸ [${new Date().toLocaleTimeString()}] ìŒì„±ì¸ì‹ íƒ€ì´ë¨¸ ì¤‘ë‹¨ - ë‚¨ì€ ì‹œê°„: ${remainingRecognitionTime}ì´ˆ`);
            }
            
            if (currentWaitTimeout) {
                clearInterval(currentWaitTimeout);
                currentWaitTimeout = null;
                console.log(`â¸ï¸ [${new Date().toLocaleTimeString()}] ëŒ€ê¸° íƒ€ì´ë¨¸ ì¤‘ë‹¨ - ë‚¨ì€ ì‹œê°„: ${remainingWaitTime}ì´ˆ`);
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('start-btn').disabled = false;
            document.getElementById('pause-btn').disabled = true;
            
            // í˜„ì¬ ìƒíƒœì— ë”°ë¼ pause ìƒíƒœ í‘œì‹œ
            const countdownTimer = document.getElementById('countdown-timer');
            if (currentPhase === 'countdown') {
                countdownTimer.textContent = `ì¼ì‹œì •ì§€ë¨ - ì‚¬ê³ ì‹œê°„ ${remainingCountdownTime}ì´ˆ ë‚¨ìŒ`;
                countdownTimer.style.color = '#f59e0b';
            } else if (currentPhase === 'recognition') {
                countdownTimer.textContent = `ì¼ì‹œì •ì§€ë¨ - ìŒì„±ì¸ì‹ ${remainingRecognitionTime}ì´ˆ ë‚¨ìŒ`;
                countdownTimer.style.color = '#f59e0b';
            } else if (currentPhase === 'waiting') {
                countdownTimer.textContent = `ì¼ì‹œì •ì§€ë¨ - ë‹¤ìŒ ë¬¸ì œê¹Œì§€ ${remainingWaitTime}ì´ˆ ë‚¨ìŒ`;
                countdownTimer.style.color = '#f59e0b';
            }
        }
        
        // í›ˆë ¨ ì¬ì„¤ì •
        function resetTraining() {
            isRunning = false;
            isPaused = false;
            currentIndex = 0;
            
            // ëª¨ë“  ê¸€ë¡œë²Œ íƒ€ì´ë¨¸ ì •ë¦¬
            if (currentCountdownInterval) {
                clearInterval(currentCountdownInterval);
                currentCountdownInterval = null;
            }
            if (currentRecognitionCountdown) {
                clearInterval(currentRecognitionCountdown);
                currentRecognitionCountdown = null;
            }
            if (currentWaitTimeout) {
                clearInterval(currentWaitTimeout);
                currentWaitTimeout = null;
            }
            
            // ê¸€ë¡œë²Œ ë³€ìˆ˜ ì´ˆê¸°í™”
            remainingCountdownTime = 0;
            remainingRecognitionTime = 0;
            remainingWaitTime = 0;
            currentPhase = 'idle';
            
            document.getElementById('start-btn').disabled = false;
            document.getElementById('pause-btn').disabled = true;
            document.getElementById('korean-text').textContent = 'í•œêµ­ì–´ë¥¼ ë“£ê³  ì˜ì–´ë¡œ ë§í•´ë³´ì„¸ìš”';
            document.getElementById('english-answer').textContent = '';
            document.getElementById('english-answer').classList.remove('show');
            document.getElementById('timer').style.display = 'none';
            document.getElementById('speech-test-area').style.display = 'none';
            
            updateProgress();
        }
        
        // í›ˆë ¨ ì™„ë£Œ
        function completeTraining() {
            isRunning = false;
            
            alert(`ğŸ‰ Stage ${stageNumber} í›ˆë ¨ ì™„ë£Œ!\n\nëª¨ë“  ê³ ê¸‰ ë¬¸ë²• íŒ¨í„´ì„ ì—°ìŠµí–ˆìŠµë‹ˆë‹¤.\nê³„ì†í•´ì„œ ë‹¤ë¥¸ ìŠ¤í…Œì´ì§€ë„ ë„ì „í•´ë³´ì„¸ìš”!`);
            
            document.getElementById('korean-text').textContent = 'í›ˆë ¨ ì™„ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.';
            document.getElementById('english-answer').textContent = '';
            document.getElementById('english-answer').classList.remove('show');
            document.getElementById('timer').style.display = 'none';
            document.getElementById('speech-test-area').style.display = 'none';
            
            document.getElementById('start-btn').disabled = false;
            document.getElementById('pause-btn').disabled = true;
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('start-btn').addEventListener('click', startTraining);
        document.getElementById('pause-btn').addEventListener('click', pauseTraining);
        document.getElementById('reset-btn').addEventListener('click', resetTraining);
        
        // ì´ˆê¸°í™”
        loadLevel3Data();
    </script>
</body>
</html>
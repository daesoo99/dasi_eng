<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .stage { padding: 5px 0; }
        .stage.complete { color: green; }
        .stage.error { color: red; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ë¹„ë™ê¸° ì²˜ë¦¬ + ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ í…ŒìŠ¤íŠ¸</h1>
    
    <button onclick="testStreaming()">ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    <button onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    
    <div id="logs"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const logsDiv = document.getElementById('logs');
        
        function addLog(message, className = '') {
            const logDiv = document.createElement('div');
            logDiv.className = `stage ${className}`;
            logDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        function clearLogs() {
            logsDiv.innerHTML = '';
        }
        
        function testStreaming() {
            addLog('ğŸ”— /realtime ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì—°ê²° ì‹œë„...', 'info');
            
            // /realtime ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì—°ê²°
            const socket = io('/realtime');
            
            socket.on('connect', () => {
                addLog('âœ… /realtime ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì—°ê²° ì„±ê³µ', 'complete');
                
                // í…ŒìŠ¤íŠ¸ í˜ì´ë¡œë“œ ì „ì†¡
                const testPayload = {
                    audioBlob: 'test-audio-data',
                    voice: 'female',
                    prompt: 'Test prompt for LLM processing'
                };
                
                addLog('ğŸ“¤ stt_llm_tts ì´ë²¤íŠ¸ ì „ì†¡...', 'info');
                socket.emit('stt_llm_tts', testPayload);
            });
            
            socket.on('stage', (data) => {
                switch(data.step) {
                    case 'STT_START':
                        addLog('ğŸ¤ STT ì²˜ë¦¬ ì‹œì‘...', 'info');
                        break;
                    case 'STT_DONE':
                        addLog(`âœ… STT ì™„ë£Œ: "${data.text}"`, 'complete');
                        break;
                    case 'LLM_START':
                        addLog('ğŸ§  LLM ì²˜ë¦¬ ì‹œì‘...', 'info');
                        break;
                    case 'LLM_DONE':
                        addLog(`âœ… LLM ì™„ë£Œ: "${data.partial}"`, 'complete');
                        break;
                    case 'TTS_START':
                        addLog('ğŸ”Š TTS ì²˜ë¦¬ ì‹œì‘...', 'info');
                        break;
                    case 'TTS_DONE':
                        addLog(`âœ… TTS ì™„ë£Œ: ${data.audioUrl}`, 'complete');
                        break;
                }
            });
            
            socket.on('complete', (data) => {
                addLog('ğŸ‰ ì „ì²´ íŒŒì´í”„ë¼ì¸ ì™„ë£Œ!', 'complete');
                socket.disconnect();
            });
            
            socket.on('error', (data) => {
                addLog(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${data.message}`, 'error');
                socket.disconnect();
            });
            
            socket.on('disconnect', () => {
                addLog('âŒ ì—°ê²° í•´ì œ', 'info');
            });
            
            socket.on('connect_error', (error) => {
                addLog(`âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            });
        }
    </script>
</body>
</html>